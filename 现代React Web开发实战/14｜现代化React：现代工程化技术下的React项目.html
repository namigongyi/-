<audio title="14｜现代化React：现代工程化技术下的React项目" src="https://static001.geekbang.org/resource/audio/3c/ba/3cf730ce974da9c8c4c5385935ddc0ba.mp3" controls="controls"></audio> 
<p>你好，我是宋一玮，欢迎回到React应用开发的学习。</p><p>在第<a href="https://time.geekbang.org/column/article/571276">12</a>、<a href="https://time.geekbang.org/column/article/574161">13</a>节课，我们学习了React的单向数据流，以及怎么用面向接口编程的思想指导组件设计开发。同时我们一起为oh-my-kanban做了一次大重构，实践了刚学到的概念和方法。可以说，我们在学习写React应用代码方面，已经获得了阶段性进展。</p><p>但也需要知道，写出来的源码毕竟还不能用来上线，还得经过 <code>npm run build</code> 打包构建出生产环境代码，然后才能上线。你可能会好奇，这个命令都做了什么？这个命令是CRA，由Create React App脚手架工具提供，它的内部<strong>对开发者而言是个黑盒</strong>。要想了解它，我们得先把黑盒打开，或者，用更好的方式：<strong>自己搭一个白盒</strong>出来。</p><p>还记得在上节课末尾的预告吗？这节课我会带着你，不依赖CRA，<strong>用现代的工程化技术重新搭建一个React项目，然后把oh-my-kanban的代码迁移过来</strong>，让它真正成为你自己的项目。</p><p>好的，现在开始这节课的内容。</p><h2>CRA为我们做了什么？</h2><p>在<a href="https://time.geekbang.org/column/article/553817">第3节课</a>，我们用FB官方提供的CRA脚手架工具创建了oh-my-kanban项目，在这之后我们就一直专注于代码开发，再也没有关注过项目配置了。现在oh-my-kanban项目开发已经步入正轨，是时候回过头来看看CRA为我们做了哪些事情。</p><!-- [[[read_end]]] --><p>在项目根目录package.json文件的scripts节点下，有四个NPM命令。</p><p>最先接触的 <code>npm start</code> ，你对它的使用应该已经比较熟悉了。这个命令启动了一个开发服务器（Dev Server），内置了开发环境构建（Development Build）、监听文件变化（Watch）、增量构建（Incremental Build）、模块热替换（Hot Module Replacement）等功能。其实这些功能你在前面的开发实践中都用到了。</p><p>与这个命令对应的还有生产环境构建。</p><h3>生产环境构建</h3><p>我想请你在oh-my-kanban项目根目录运行一遍 <code>npm run build</code> ，它会打包构建出生产环境的代码。现在只看生成的JS/CSS文件：</p><pre><code class="language-plain">build/static
├── css
│&nbsp; &nbsp;├── main.9411d92b.css            1.2K
│&nbsp; &nbsp;└── main.9411d92b.css.map
├── js
│&nbsp; &nbsp;├── 787.4ea3479b.chunk.js        4.5K
│&nbsp; &nbsp;├── 787.4ea3479b.chunk.js.map
│&nbsp; &nbsp;├── main.7ed853e1.js             166K
│&nbsp; &nbsp;├── main.7ed853e1.js.LICENSE.txt
│&nbsp; &nbsp;└── main.7ed853e1.js.map
└── media
&nbsp; &nbsp; └── logo.6ce24c58023cc2f8fd88fe9d219db6c6.svg
</code></pre><p>如果你的项目源码是跟课程的代码仓库同步的，请你运行 <code>git checkout a70667e</code> ，检出<a href="https://time.geekbang.org/column/article/553817">第3节课</a>刚初始化CRA项目时的代码，再跑一次 <code>npm run build</code> ，你会发现构建结果的文件个数和大小都大同小异：</p><pre><code class="language-plain">build/static
├── css
│&nbsp; &nbsp;├── main.073c9b0a.css             1.0K
│&nbsp; &nbsp;└── main.073c9b0a.css.map
├── js
│&nbsp; &nbsp;├── 787.4ea3479b.chunk.js         4.5K
│&nbsp; &nbsp;├── 787.4ea3479b.chunk.js.map
│&nbsp; &nbsp;├── main.be7e86b0.js              140K
│&nbsp; &nbsp;├── main.be7e86b0.js.LICENSE.txt
│&nbsp; &nbsp;└── main.be7e86b0.js.map
└── media
&nbsp; &nbsp; └── logo.6ce24c58023cc2f8fd88fe9d219db6c6.svg
</code></pre><p>你从<a href="https://time.geekbang.org/column/article/553817">第3节课</a>到<a href="https://time.geekbang.org/column/article/574161">13节课</a>写的代码，为生产环境代码增加了26.2KB，这包括了运行时依赖项emotion。这些生产环境代码是可以用于上线的。</p><p>下一个是 <code>npm test</code>，用于执行Jest自动化测试。我们会在后面的第20～22节详细介绍React自动化测试，这里暂时先跳过。</p><h3>从CRA下车</h3><p>最后来到 <code>npm run eject</code> 。相信你已经把之前的代码都提交到代码仓库了吧？那放心执行它，遇到确认提示直接敲回车，直到你看到 <code>Ejected successfully!</code> 就成功了。你发现项目突然多了十来个新文件，纳闷地问这个命令是什么意思？</p><p>Eject的字面意思是弹出，比如飞行员从战斗机中紧急弹出就是这个词。执行了这个命令，就代表你从CRA下车了：这个项目不再依赖CRA，CRA封装的各种工程化功能，都被打散加入到这个项目的代码中，你可以根据需要做深度定制。</p><p>根据打散出来的文件，可以看到CRA包含的基本功能：</p><ul>
<li>基于Webpack的开发服务器和生产环境构建；</li>
<li>用Babel做代码转译（Transpile）；</li>
<li>基于Jest和@testing-library/react的自动化测试框架；</li>
<li>ESLint代码静态检查；</li>
<li>以PostCSS为首的CSS后处理器。</li>
</ul><p>前端框架与脚手架工具之间是相辅相成的关系，一般而言后者比前者更有<strong>倾向性</strong>（Opinionated）。工具（或框架）具有倾向性，意味着它<strong>对你的使用场景做了假设和限定，为你提供了它认为是最有效或是最佳实践的默认配置</strong>。</p><p>当你和这样的工具一拍即合时，它会简化你需要解决的问题，提升你的开发效率；但当你有深度自定义的需求时，它能提供的灵活性往往是有限的，这时你就需要重新考虑是否仍要采用这个工具了。</p><p>其实到目前我们对CRA还没有什么不满。不过出于学习目的，我们<strong>暂时从CRA下车</strong>，然后开始自己搭建一套现代化的React项目。</p><h2>搭建一个新项目</h2><p>既然决定不依赖脚手架工具，那么就需要自己一边做技术选型，一边分步骤搭建一个新项目。我们已经确定的技术栈包括：</p><ul>
<li>Node.js v16 LTS；</li>
<li>NPM v8包管理器；</li>
<li>React v18.2.0；</li>
<li>Emotion CSS-in-JS库；</li>
<li>浏览器Web技术。</li>
</ul><p>至于其他技术栈，我们一边搭建一边引入。</p><p>创建前端项目没什么需要注意的，先起个新的项目名吧，<code>yeah-my-kanban</code> 怎么样：</p><pre><code class="language-bash">mkdir yeah-my-kanban &amp;&amp; cd yeah-my-kanban
git init
npm init -y
</code></pre><p>接着，在刚创建的 <code>package.json</code> 里加入一行 <code>"private": true,</code> ，预防不小心把项目作为NPM包发布出去。</p><p>然后，在项目根目录加入 <code>.nvmrc</code> 文件用于约定Node.js版本。<code>fnm</code> 、 <code>nvm</code> 工具都能可以识别这个文件名，文件内容只有一行：</p><pre><code class="language-bash">16.17.1
</code></pre><p>同时把 <code>oh-my-kanban</code> 的 <code>.gitignore</code> 文件直接拷贝过来，这个文件可以避免把不必要的文件提交到git代码仓库中。</p><p>在开始迁移oh-my-kanban源码之前，需要先为项目配置构建工具。</p><h3>安装构建工具Vite</h3><p>在直播时我们曾讨论过，无论是软件工程化还是前端工程化，都是为了解决在开发中存在的痛点，提升开发效率效果。<strong>构建</strong>（Build）也是前端工程化领域最重要的话题之一。</p><p>Webpack是前端领域最流行的<strong>静态模块打包器</strong>（Bundler），前面的CRA脚手架选用Webpack作为基础，以插件的形式加入代码转译、CSS后处理、整合图片资源等功能，这样就可以支持完整的前端构建过程了。</p><p>Bundler+插件之所以能成为前端构建工具的主流，很大程度上是因为浏览器技术的限制。现代JS应用开发动辄数十个依赖项、上百个源文件、上万行源代码，而传统浏览器由于JS引擎功能和网络性能等限制，无法直接消费这些JS，所以就需要Bundler来打包并优化交付给浏览器的产物。这其实也是一种对JS开发过程和浏览器环境适配的<strong>关注点分离</strong>（Separation Of Concerns)。</p><p>然而这个限制正在慢慢被放宽，现代浏览器开始支持HTTP/2、ECMAScript Modules标准，一些新兴的前端构建工具已经开始利用这些新功能。我们基于这个趋势，选择了Vite（<a href="https://cn.vitejs.dev/">官网</a>）作为<code>yeah-my-kanban</code> 的构建工具。</p><p>Vite为开发环境和生产环境提供了不同的方案，在开发时，Vite提供了基于ESBuild的开发服务器，平均构建速度远超Webpack；为生产环境，Vite提供了基于Rollup的构建命令和预设配置集，构建出的产物，能达到与Webpack相当的优化程度和兼容性。</p><p>Vite官方也提供了create-vite脚手架工具，但我们很倔强地不用，直接安装Vite：</p><pre><code class="language-bash">npm install -D vite
</code></pre><p>在<code>package.json</code> 里加入两个新的命令：</p><pre><code class="language-javascript">  "scripts": {
    "start": "vite dev --open", 
    "build": "vite build",
</code></pre><p>再在项目根目录添加一个入口HTML文件 <code>index.html</code> ：</p><pre><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&nbsp; &lt;head&gt;
&nbsp; &nbsp; &lt;meta charset="utf-8" /&gt;
&nbsp; &nbsp; &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
&nbsp; &nbsp; &lt;title&gt;React App&lt;/title&gt;
&nbsp; &lt;/head&gt;
&nbsp; &lt;body&gt;
&nbsp; &nbsp; &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;
&nbsp; &nbsp; &lt;div id="root"&gt;&lt;/div&gt;
&nbsp; &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>运行 <code>npm start</code> ，好的，浏览器自动打开页面，虽然里面什么内容都没有。</p><h3>配置React插件</h3><p>安装react，顺便安装Vite的React插件：</p><pre><code class="language-bash">npm install react react-dom
npm install -D @vitejs/plugin-react
</code></pre><p>加入一个配置文件 <code>vite.config.js</code> ：</p><pre><code class="language-javascript">import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
&nbsp; plugins: [react()]
});
</code></pre><p>运行 <code>npm start</code> ：</p><p><img src="https://static001.geekbang.org/resource/image/c8/e8/c8ea7f57d613ac4e2a3b3239ee7cafe8.png?wh=721x233" alt="图片"></p><p>把 <code>oh-my-kanban</code> 的src/index.js文件拷过来，改名为src/index.jsx，暂时注释掉一部分内容：</p><pre><code class="language-javascript">import React from 'react';
import ReactDOM from 'react-dom/client';
// import './index.css';
// import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  &lt;React.StrictMode&gt;
    {/* &lt;App /&gt; */}
    &lt;div&gt;Yeah My Kanban&lt;/div&gt;
  &lt;/React.StrictMode&gt;
);

</code></pre><p>回到Vite的入口文件 <code>index.html</code> ，在 <code>&lt;body&gt;</code> 封闭标签最后加入一行特殊的 <code>&lt;script&gt;</code> 标签：</p><pre><code class="language-xml">    &lt;script type="module" src="./src/index.jsx"&gt;&lt;/script&gt;
</code></pre><p>Vite自动构建：</p><p><img src="https://static001.geekbang.org/resource/image/11/b8/11ed946d7ba9015dc0ffbc01384a58b8.png?wh=721x233" alt="图片"></p><p>浏览器页面自动更新，显示出“Yeah My Kanban”字样了：</p><p><img src="https://static001.geekbang.org/resource/image/52/01/52bdcc422994dd68d6a38077249ceb01.png?wh=1268x668" alt="图片"></p><h3>配置Emotion</h3><p>在Vite里配置 <code>emotion</code> 会稍微啰嗦些。安装 <code>emotion</code> 时需要额外安装一个开发依赖项：</p><pre><code class="language-bash">npm install @emotion/react
npm install -D @emotion/babel-plugin
</code></pre><p>修改配置文件<code>vite.config.js</code> ，利用 <code>emotion</code> 的Babel插件为JSX加入 <code>css</code> 属性，这样也不需要在每个JSX文件开头写 <code>JSX Pragma</code> 了：</p><pre><code class="language-javascript">export default defineConfig({
  plugins: [
    react({
      jsxImportSource: '@emotion/react',
      babel: {
        plugins: ['@emotion/babel-plugin'],
      },
    }),
  ],
});
</code></pre><p>好了，准备工作完成，可以开始把 <code>oh-my-kanban</code> 的源码迁移至 <code>yeah-my-kanban</code> 了。</p><h2>迁移项目源码</h2><p>首先，把除了 <code>oh-my-kanban/src/index.js</code> 的组件文件、样式文件和context文件，一股脑地拷贝到 <code>yeah-my-kanban/src/components</code> 下。</p><p>再把里面的context文件移动到  <code>src/context/AdminContext.js</code> ，这时VSCode会提示是否更新它在其他文件中的导入路径，选择“是”。然后把所有的组件文件扩展名改成 <code>.jsx</code> ，否则Vite不认。目前 <code>yeah-my-kanban</code> 的源码应该是这样的：</p><pre><code class="language-plain">src
├── components
│&nbsp; &nbsp;├── App.css
│&nbsp; &nbsp;├── App.jsx
│&nbsp; &nbsp;├── KanbanBoard.jsx
│&nbsp; &nbsp;├── KanbanCard.jsx
│&nbsp; &nbsp;├── KanbanColumn.jsx
│&nbsp; &nbsp;├── KanbanNewCard.jsx
│&nbsp; &nbsp;└── logo.svg
├── context
│&nbsp; &nbsp;└── AdminContext.js
├── index.css
└── index.jsx
</code></pre><p>所有<code>.jsx</code> 文件第一行的 <code>/** @jsxImportSource @emotion/react */</code> 可以删掉了。</p><p>把 <code>yeah-my-kanban/src/index.jsx</code> 的注释代码还原，注意 <code>App</code> 的导入路径变了：</p><pre><code class="language-javascript">import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './components/App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  &lt;React.StrictMode&gt;
    &lt;App /&gt;
  &lt;/React.StrictMode&gt;
);
</code></pre><p>完成。运行 <code>npm start</code> ，浏览器中出现了熟悉的页面：</p><p><img src="https://static001.geekbang.org/resource/image/34/19/34d068a15051d2b517f0ef32b7b9a319.png?wh=1312x712" alt="图片"></p><p>这时你也会发现，<strong>Vite的开发服务器启动和初次构建都明显比Webpack快</strong>。对于<code>yeah-my-kanban</code> 这样体量很小的项目，这种速度提升不算明显。不过随着项目规模提升，Vite构建的速度优势就体现出来了。</p><p>好了，迁移完成！也许你原本以为还需要很多步骤，但其实到这里我们的源码迁移已经成功完成了。你可以把<code>yeah-my-kanban</code> 项目的源码也提交到代码仓库里。</p><h2>为编写代码保驾护航</h2><p>接下来是与源码开发相关的工程化实践，包括代码自动补全、代码静态检查、单元测试、Git Hook。其中单元测试，我们留到后面第20～22节课详细介绍，这里暂时先跳过。</p><h3>代码自动补全</h3><p>现代JS开发是很幸福的，自从有了TypeScript生态，基本上常用的开源库都会以 <code>*.d.ts</code> 形式提供Types定义，IDE读取这些定义，可以提供精准的代码自动补全列表；有不少库还同时提供了丰富的JSDoc或TSDoc文档，IDE可以在代码提示中内嵌展示出来。</p><p>可以在安装React的Types：</p><pre><code class="language-bash">npm install -D @types/react @types/react-dom
</code></pre><p><img src="https://static001.geekbang.org/resource/image/9d/79/9d09751de4cc7e4cb1bc9fde36beea79.png?wh=1100x860" alt="图片"></p><p>如果你在VSCode中发现你什么都还没做，就能有React API的代码自动补全，那是因为它已经提前内置了。</p><h3>代码静态检查</h3><p>代码毕竟还是人编写的，人一定会犯错，这点不用避讳。<strong>代码静态检查</strong>（Linting）<strong>是通过静态代码分析，为开发者指出代码中可能的编程错误和代码风格问题，并提出修改建议</strong>，达到提升代码质量的目的。因此代码静态检查器（Linter），就是开发者的好伙伴。</p><p>在JS生态中，目前最强大使用最广泛的是<strong>ESLint</strong>（<a href="https://eslint.org/">官网</a>）。</p><p>安装ESLint：</p><pre><code class="language-bash">npm init @eslint/config -y
</code></pre><p>安装命令会依次问几个问题，大部分用默认值就行。其中需要注意，对于“你打算怎样使用ESLint？”这个问题，请选择第三项“检查语法，寻找错误，规范代码风格”：</p><pre><code class="language-plain">? How would you like to use ESLint? …
&nbsp; To check syntax only
&nbsp; To check syntax and find problems
❯ To check syntax, find problems, and enforce code style
</code></pre><p>后面还有一个问题，“你打算怎样定义项目的代码风格？”，请选择第一项“选择一个流行的代码风格指南”，随后我推荐选择Airbnb的代码风格：</p><pre><code class="language-plain">? How would you like to define a style for your project? …
❯ Use a popular style guide
&nbsp; Answer questions about your style
? Which style guide do you want to follow? …
❯ Airbnb: https://github.com/airbnb/javascript
&nbsp; Standard: https://github.com/standard/standard
&nbsp; Google: https://github.com/google/eslint-config-google
&nbsp; XO: https://github.com/xojs/eslint-config-xo
</code></pre><p>运行完命令行会提示：</p><pre><code class="language-plain">✔ How would you like to use ESLint? · style
✔ What type of modules does your project use? · esm
✔ Which framework does your project use? · react
✔ Does your project use TypeScript? · No / Yes
✔ Where does your code run? · browser
✔ How would you like to define a style for your project? · guide
✔ Which style guide do you want to follow? · airbnb
✔ What format do you want your config file to be in? · JavaScript
Checking peerDependencies of eslint-config-airbnb@latest
Local ESLint installation not found.
The config that you've selected requires the following dependencies:

eslint-plugin-react@^7.28.0 eslint-config-airbnb@latest eslint@^7.32.0 || ^8.2.0 eslint-plugin-import@^2.25.3 eslint-plugin-jsx-a11y@^6.5.1 eslint-plugin-react-hooks@^4.3.0
✔ Would you like to install them now? · No / Yes
✔ Which package manager do you want to use? · npm

Installing eslint-plugin-react@^7.28.0, eslint-config-airbnb@latest, eslint@^7.32.0 || ^8.2.0, eslint-plugin-import@^2.25.3, eslint-plugin-jsx-a11y@^6.5.1, eslint-plugin-react-hooks@^4.3.0
</code></pre><p>安装完成，项目根目录多了一个 <code>.eslintrc.js</code> 配置文件。</p><p>你已经等不急要体验一下ESLint的功能了。在<code>package.json</code> 中增加一个NPM命令：</p><p><img src="https://static001.geekbang.org/resource/image/b4/8d/b4f3637f33246096e05b556572da848d.png?wh=1368x288" alt="图片"></p><p>为了避免误伤，在 <code>vite.config.js</code> 顶部插入一行：</p><pre><code class="language-diff">/* eslint-disable import/no-extraneous-dependencies */
</code></pre><p>好了，执行 <code>npm run lint</code> ，结果如下：</p><p><img src="https://static001.geekbang.org/resource/image/df/ff/dfcdc476258c60cee24a82219d0923ff.png?wh=865x556" alt="图片"></p><pre><code class="language-diff">✖ 86 problems (86 errors, 0 warnings)
&nbsp; 37 errors and 0 warnings potentially fixable with the `--fix` option.
</code></pre><p>居然检查出这么多错误？别担心，大部分都是代码格式的报错，反正代码提交过了，我们可以放心使用自动修正功能。运行 <code>npm run lint -- --fix</code> ，ESLint自动修正了一部分错误，还剩50多个错误。接下来，让我们看看还剩下哪些典型的错误。</p><h4>Lint规则：禁止不被使用的表达式</h4><p>对应的规则说明在这里：<a href="https://eslint.org/docs/latest/rules/no-unused-expressions">https://eslint.org/docs/latest/rules/no-unused-expressions</a>。</p><p><img src="https://static001.geekbang.org/resource/image/64/47/64b539e059fbf0b0a01f10bc02703a47.png?wh=1003x207" alt="图片"></p><p>上面代码中的表达式，在JS中有个专门的称呼：<strong>短路表达式</strong>（Short-Circuit Expression），在前端开发中还是很常用的。我们在 <code>.eslintrc.js</code> 的 <code>rules</code> 字段中加入如下一行规则，为它开个绿灯：</p><pre><code class="language-javascript">&nbsp; rules: {
&nbsp; &nbsp; 'no-unused-expressions': ['error', { allowShortCircuit: true }],
&nbsp; },
</code></pre><h4>Lint规则：禁止在函数内部修改函数参数</h4><p>对应的规则说明在这里：<a href="https://eslint.org/docs/latest/rules/no-param-reassign">https://eslint.org/docs/latest/rules/no-param-reassign</a>。</p><p><img src="https://static001.geekbang.org/resource/image/cb/a4/cb7c2d6ef7d374f376d12cbe004d00a4.png?wh=857x283" alt="图片"></p><p>这个规则是非常有用的，可以避免很多编程问题。但 <code>dropEffect</code> 算是特例，我们加条规则排除掉它：</p><pre><code class="language-javascript">'no-param-reassign': ['error', { props: true, ignorePropertyModificationsFor: ['evt'] }],
</code></pre><h4>Lint规则：React组件的props需要定义PropTypes</h4><p>对应的规则说明在这里：<a href="https://github.com/jsx-eslint/eslint-plugin-react/blob/master/docs/rules/prop-types.md">https://github.com/jsx-eslint/eslint-plugin-react/blob/master/docs/rules/prop-types.md</a>。</p><p><img src="https://static001.geekbang.org/resource/image/36/f4/36b81bd0da463f560b10ccd70d6a61f4.png?wh=1126x250" alt="图片"></p><p>我们后面第17节课会讲到PropTyps，所以现在先无视它。在 <code>.eslintrc.js</code> 的 <code>rules</code> 字段中加入如下一行规则，以覆盖 <code>plugin:react/recommended</code> 规则集中的默认值：</p><pre><code class="language-javascript">'react/prop-types': ['error', { skipUndeclared: true }],
</code></pre><h4>Lint规则：React组件禁止使用未知的DOM属性</h4><p>对应的规则说明在这里：<a href="https://github.com/jsx-eslint/eslint-plugin-react/blob/master/docs/rules/no-unknown-property.md">https://github.com/jsx-eslint/eslint-plugin-react/blob/master/docs/rules/no-unknown-property.md</a>。</p><p><img src="https://static001.geekbang.org/resource/image/3d/7d/3def7db7e92bc6181521aeba2b417a7d.png?wh=834x349" alt="图片"></p><p>这个属于误伤，<code>plugin:react/recommended</code> 并不知道emotion框架的存在。加一行配置忽略它：</p><pre><code class="language-javascript">'react/no-unknown-property': ['error', { ignore: ['css'] }],
</code></pre><p>再跑一次 <code>npm run lint</code> ，还剩11个错误。你可以尝试自己修正或者忽略它们。</p><h4>Lint规则：检查React Hooks的使用规则</h4><p>等一下还没完，请你回忆第10节课学习的React Hooks的使用规则，ESLint能帮上忙吗？故意用错Hooks试试看。需要先修改 <code>.eslintrc.js</code> ，启用Airbnb代码规则集里Hooks的部分：</p><p><img src="https://static001.geekbang.org/resource/image/8f/58/8f536e951c46dd3617490a923c832f58.png?wh=1316x422" alt="图片"></p><p>然后故意写个Bug：</p><p><img src="https://static001.geekbang.org/resource/image/dd/38/dd0fc8fec11363e99cb7887e5988dd38.png?wh=1322x432" alt="图片"></p><p>还没运行lint命令，VSCode里就根据ESLint规则报错了：</p><p><img src="https://static001.geekbang.org/resource/image/fa/c2/fa37e7c721a828b90836b369fffacac2.png?wh=839x261" alt="图片"></p><p>对应的规则说明：<a href="https://zh-hans.reactjs.org/docs/hooks-rules.html">https://zh-hans.reactjs.org/docs/hooks-rules.html</a>。靠谱儿。</p><h3>Git Hook</h3><p>“今日事今日毕”。你开发工作忙碌一天，下班前最后一件事是什么？加班？不不，我是指提交本地代码到代码仓库，所谓“落袋为安”。就在这个提交代码过程中，你也有机会用更高标准要求自己：今天新写的代码必须通过Lint和Test，否则禁止提交。</p><p>第一步，安装Git Hook工具 <code>husky</code> ：</p><pre><code class="language-diff">npx husky-init &amp;&amp; npm install
</code></pre><p>在 <code>package.json</code> 中额外加入一个 <code>lint-staged</code> 命令：</p><p><img src="https://static001.geekbang.org/resource/image/53/85/53aef056acfd810d55d6d2814247f885.png?wh=1320x274" alt="图片"></p><p>在新加入的 <code>.husky/pre-commit</code> 中把默认的 <code>npm test</code> 改为  <code>npm run lint-staged</code>，这样之后加Git Hook只要改 <code>package.json</code> 就可以了。</p><p>来，测试一下，命令行打印 <code>Pre-commit!</code> 就成功了：</p><pre><code class="language-diff">git add .
git commit -m "Husky"
</code></pre><p>第二步，安装 <code>lint-staged</code> ，这个工具会保证只检查需要提交的文件，而不是所有文件：</p><pre><code class="language-diff">npm install -D lint-staged
</code></pre><p>在 <code>package.json</code> 中调用 <code>lint-staged</code> ：</p><p><img src="https://static001.geekbang.org/resource/image/7b/ee/7bf1b4fe3127c6931bbbddd456926aee.png?wh=1318x488" alt="图片"></p><p>随便在哪个JSX文件中加个空格，尝试提交，怎么样？你被拦住了吧（得意状）？</p><p><img src="https://static001.geekbang.org/resource/image/7a/fd/7aa8e879fe7cb898ffdb1d720c62f8fd.png?wh=865x505" alt="图片"></p><p>也不用担心，只要修好就能提交成功了。我常说 <code>lint-staged</code> 是个“自律”工具，可以逼迫自己提高代码质量。</p><h2>小结</h2><p>这节课我们不再依赖CRA，而是选用更高效的工程化工具Vite，从零开始，亲手搭建了一个新的React项目yeah-my-kanban。并且不费吹灰之力，把oh-my-kanban的代码迁移了过来，熟悉了与React应用代码直接相关的工程化概念和工具。其中我们也重点介绍了代码静态检查工具的用法和部分规则，以及Git Hook这种“自律”工具。</p><p>到此为止，你已经学习了React开发的基础内容，相信你已经有能力成为一位React开发的“独狼”工程师了。</p><p>从下节课开始，我们将进入新的模块，学习一些中型、大型React项目中会用到的技术和最佳实践，尤其是介绍当你融入一个前端开发团队时，需要的开发工作思路和方式的转变，这会帮你更从容应地对中大型React应用项目。</p><h2>思考题</h2><p>我曾强调过，前端工程化不是凭空出现的，而一定是为了解决在开发中存在的痛点，提升开发效率效果。你在前端开发过程中，尤其是第3节课到13节课期间的实践中，遇到过哪些痛点？你自己都是怎么解决的？你知道在前端技术社区有什么对应的工程化实践吗？</p><p>好了，这节课内容就是这些。“独狼”React工程师，我们下节课不见不散！</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/bc/3e/82b7deca.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>huangshan</span>
  </div>
  <div class="_2_QraFYR_0">可以补充一下关于turbopack相关的工程化吗？</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">作者回复: 你好，huangshan，感谢你的建议。Turbopack虽然被称作Webpack的继任者，但（截止到2022年10月底）它的成熟度和生态还没有达到可以与Webpack、Vite（ESBuild + Rollup）媲美的地步。我会持续关注这项技术的发展，必要时可能会做加餐。</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-10-29 20:25:00</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/9d/c4/13376c14.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>DullSword</span>
  </div>
  <div class="_2_QraFYR_0">增加NPM 命令lint出错的小伙伴可以试试：<br><br>```<br>&quot;lint&quot;: &quot;eslint \&quot;.&#47;src&#47;**&#47;*.{js,jsx}\&quot;&quot;,<br>```</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">作者回复: 赞！</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-09-28 03:18:14</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/30/61/98/0d6b499d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>船长</span>
  </div>
  <div class="_2_QraFYR_0">3-13 痛点：<br>没有报错提醒<br>没有智能提示，比如在引入 useEffect，浏览器直接报错，原因是没有在顶部 import，这时候还需要手写去引入</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">作者回复: 你好，船长，确实，自动import真是太有用了。如果你使用的是VSCode，可以参考 https:&#47;&#47;code.visualstudio.com&#47;shortcuts&#47;keyboard-shortcuts-macos.pdf 里面有快捷键 ⌃Space, ⌘I Trigger suggestion。当输入useEffect，打开代码提示，会有添加import的选项。</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-09-27 11:10:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1b/6b/c6/4cc776a7.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>百里</span>
  </div>
  <div class="_2_QraFYR_0">最近独立负责一个项目，这个课程像及时雨一样，助我成长</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-24 21:49:29</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_82fd2f</span>
  </div>
  <div class="_2_QraFYR_0">在添加ESLint的时候，如果选择Yes也就是使用TS， Does your project use TypeScript? · No &#47; Yes，规则里就不会出现Airbnb代码风格了，请问是不是Airbnb还不支持</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">作者回复: 你好，Geek_82fd2f，是的，Airbnb官方没有开源TS的代码风格，但有民间版本： https:&#47;&#47;www.npmjs.com&#47;package&#47;eslint-config-airbnb-typescript 感兴趣可以试试。<br><br>另外也可以参考第24课的开源项目： https:&#47;&#47;gitee.com&#47;evisong&#47;geektime-column-oh-my-kit&#47;blob&#47;main&#47;.eslintrc.cjs</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-11-17 14:05:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/30/61/98/0d6b499d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>船长</span>
  </div>
  <div class="_2_QraFYR_0">记得想要 Eslint 生效要启动 vscode 中的 eslint 插件。。</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">作者回复: 你好，船长，感谢提醒，确实是需要的。<br><br>其他使用VSCode但还没有安装ESLint插件的同学，强烈推荐安装：  https:&#47;&#47;marketplace.visualstudio.com&#47;items?itemName=dbaeumer.vscode-eslint</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-09-30 17:21:11</div>
  </div>
</div>
</div>
</li>
</ul>