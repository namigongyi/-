<audio title="JavaScriptæ‰§è¡Œï¼ˆä¸€ï¼‰ï¼šPromiseé‡Œçš„ä»£ç ä¸ºä»€ä¹ˆæ¯”setTimeoutå…ˆæ‰§è¡Œï¼Ÿ" src="https://static001.geekbang.org/resource/audio/65/68/651494b39e6d5304727e745cd50bfa68.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯winterã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬æ¥è®²ä¸€è®²JavaScriptçš„æ‰§è¡Œã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯æµè§ˆå™¨æˆ–è€…Nodeçš„å¼€å‘è€…ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨JavaScriptå¼•æ“ã€‚</p><p>å½“æ‹¿åˆ°ä¸€æ®µJavaScriptä»£ç æ—¶ï¼Œæµè§ˆå™¨æˆ–è€…Nodeç¯å¢ƒé¦–å…ˆè¦åšçš„å°±æ˜¯ï¼›ä¼ é€’ç»™JavaScriptå¼•æ“ï¼Œå¹¶ä¸”è¦æ±‚å®ƒå»æ‰§è¡Œã€‚</p><p>ç„¶è€Œï¼Œæ‰§è¡ŒJavaScriptå¹¶éä¸€é”¤å­ä¹°å–ï¼Œå®¿ä¸»ç¯å¢ƒå½“é‡åˆ°ä¸€äº›äº‹ä»¶æ—¶ï¼Œä¼šç»§ç»­æŠŠä¸€æ®µä»£ç ä¼ é€’ç»™JavaScriptå¼•æ“å»æ‰§è¡Œï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šæä¾›APIç»™JavaScriptå¼•æ“ï¼Œæ¯”å¦‚setTimeoutè¿™æ ·çš„APIï¼Œå®ƒä¼šå…è®¸JavaScriptåœ¨ç‰¹å®šçš„æ—¶æœºæ‰§è¡Œã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥å½¢æˆä¸€ä¸ªæ„Ÿæ€§çš„è®¤çŸ¥ï¼šä¸€ä¸ªJavaScriptå¼•æ“ä¼šå¸¸é©»äºå†…å­˜ä¸­ï¼Œå®ƒç­‰å¾…ç€æˆ‘ä»¬ï¼ˆå®¿ä¸»ï¼‰æŠŠJavaScriptä»£ç æˆ–è€…å‡½æ•°ä¼ é€’ç»™å®ƒæ‰§è¡Œã€‚</p><p>åœ¨ES3å’Œæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼ŒJavaScriptæœ¬èº«è¿˜æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œä»£ç çš„èƒ½åŠ›ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå®¿ä¸»ç¯å¢ƒä¼ é€’ç»™JavaScriptå¼•æ“ä¸€æ®µä»£ç ï¼Œå¼•æ“å°±æŠŠä»£ç ç›´æ¥é¡ºæ¬¡æ‰§è¡Œäº†ï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿå°±æ˜¯å®¿ä¸»å‘èµ·çš„ä»»åŠ¡ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ES5ä¹‹åï¼ŒJavaScriptå¼•å…¥äº†Promiseï¼Œè¿™æ ·ï¼Œä¸éœ€è¦æµè§ˆå™¨çš„å®‰æ’ï¼ŒJavaScriptå¼•æ“æœ¬èº«ä¹Ÿå¯ä»¥å‘èµ·ä»»åŠ¡äº†ã€‚</p><!-- [[[read_end]]] --><p>ç”±äºæˆ‘ä»¬è¿™é‡Œä¸»è¦è®²JavaScriptè¯­è¨€ï¼Œé‚£ä¹ˆé‡‡çº³JSCå¼•æ“çš„æœ¯è¯­ï¼Œæˆ‘ä»¬æŠŠå®¿ä¸»å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå®è§‚ä»»åŠ¡ï¼ŒæŠŠJavaScriptå¼•æ“å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå¾®è§‚ä»»åŠ¡ã€‚</p><h2>å®è§‚å’Œå¾®è§‚ä»»åŠ¡</h2><p>JavaScriptå¼•æ“ç­‰å¾…å®¿ä¸»ç¯å¢ƒåˆ†é…å®è§‚ä»»åŠ¡ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸ç­‰å¾…çš„è¡Œä¸ºéƒ½æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ‰€ä»¥åœ¨Nodeæœ¯è¯­ä¸­ï¼Œä¹Ÿä¼šæŠŠè¿™ä¸ªéƒ¨åˆ†ç§°ä¸ºäº‹ä»¶å¾ªç¯ã€‚</p><p>ä¸è¿‡ï¼Œæœ¯è¯­æœ¬èº«å¹¶éæˆ‘ä»¬éœ€è¦é‡ç‚¹è®¨è®ºçš„å†…å®¹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡ŒæŠŠé‡ç‚¹æ”¾åœ¨äº‹ä»¶å¾ªç¯çš„åŸç†ä¸Šã€‚åœ¨åº•å±‚çš„C/C++ä»£ç ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªè·‘åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­çš„å¾ªç¯ï¼Œæˆ‘ä»¬ç”¨ä¼ªä»£ç æ¥è¡¨ç¤ºï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="language-C">while(TRUE) {
    r = wait();
    execute(r);
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªå¾ªç¯åšçš„äº‹æƒ…åŸºæœ¬ä¸Šå°±æ˜¯åå¤â€œç­‰å¾…-æ‰§è¡Œâ€ã€‚å½“ç„¶ï¼Œå®é™…çš„ä»£ç ä¸­å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œè¿˜æœ‰è¦åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸã€å®è§‚ä»»åŠ¡é˜Ÿåˆ—ç­‰é€»è¾‘ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘å°±æŠŠè¿™äº›éƒ½çœç•¥æ‰äº†ã€‚</p><p>è¿™é‡Œæ¯æ¬¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶å®éƒ½æ˜¯ä¸€ä¸ªå®è§‚ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥å¤§æ¦‚ç†è§£ï¼šå®è§‚ä»»åŠ¡çš„é˜Ÿåˆ—å°±ç›¸å½“äºäº‹ä»¶å¾ªç¯ã€‚</p><p>åœ¨å®è§‚ä»»åŠ¡ä¸­ï¼ŒJavaScriptçš„Promiseè¿˜ä¼šäº§ç”Ÿå¼‚æ­¥ä»£ç ï¼ŒJavaScriptå¿…é¡»ä¿è¯è¿™äº›å¼‚æ­¥ä»£ç åœ¨ä¸€ä¸ªå®è§‚ä»»åŠ¡ä¸­å®Œæˆï¼Œå› æ­¤ï¼Œæ¯ä¸ªå®è§‚ä»»åŠ¡ä¸­åˆåŒ…å«äº†ä¸€ä¸ªå¾®è§‚ä»»åŠ¡é˜Ÿåˆ—ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/16/65/16f70a9a51a65d5302166b0d78414d65.jpg?wh=1398*1636" alt=""></p><p>æœ‰äº†å®è§‚ä»»åŠ¡å’Œå¾®è§‚ä»»åŠ¡æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°JavaScriptå¼•æ“çº§å’Œå®¿ä¸»çº§çš„ä»»åŠ¡äº†ï¼Œä¾‹å¦‚ï¼šPromiseæ°¸è¿œåœ¨é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å¾®è§‚ä»»åŠ¡ã€‚setTimeoutç­‰å®¿ä¸»APIï¼Œåˆ™ä¼šæ·»åŠ å®è§‚ä»»åŠ¡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹Promiseã€‚</p><h2>Promise</h2><p>Promiseæ˜¯JavaScriptè¯­è¨€æä¾›çš„ä¸€ç§æ ‡å‡†åŒ–çš„å¼‚æ­¥ç®¡ç†æ–¹å¼ï¼Œå®ƒçš„æ€»ä½“æ€æƒ³æ˜¯ï¼Œéœ€è¦è¿›è¡Œioã€ç­‰å¾…æˆ–è€…å…¶å®ƒå¼‚æ­¥æ“ä½œçš„å‡½æ•°ï¼Œä¸è¿”å›çœŸå®ç»“æœï¼Œè€Œè¿”å›ä¸€ä¸ªâ€œæ‰¿è¯ºâ€ï¼Œå‡½æ•°çš„è°ƒç”¨æ–¹å¯ä»¥åœ¨åˆé€‚çš„æ—¶æœºï¼Œé€‰æ‹©ç­‰å¾…è¿™ä¸ªæ‰¿è¯ºå…‘ç°ï¼ˆé€šè¿‡Promiseçš„thenæ–¹æ³•çš„å›è°ƒï¼‰ã€‚</p><p>Promiseçš„åŸºæœ¬ç”¨æ³•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>    function sleep(duration) {
        return new Promise(function(resolve, reject) {
            setTimeout(resolve,duration);
        })
    }
    sleep(1000).then( ()=&gt; console.log(&quot;finished&quot;));
</code></pre><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°sleepï¼Œå®ƒçš„ä½œç”¨æ˜¯ç­‰å€™ä¼ å…¥å‚æ•°æŒ‡å®šçš„æ—¶é•¿ã€‚</p><p>Promiseçš„thenå›è°ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥ç ”ç©¶ä¸€ä¸‹Promiseå‡½æ•°ä¸­çš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ç¤ºä¾‹ï¼š</p><pre><code>    var r = new Promise(function(resolve, reject){
        console.log(&quot;a&quot;);
        resolve()
    });
    r.then(() =&gt; console.log(&quot;c&quot;));
    console.log(&quot;b&quot;)
</code></pre><p>æˆ‘ä»¬æ‰§è¡Œè¿™æ®µä»£ç åï¼Œæ³¨æ„è¾“å‡ºçš„é¡ºåºæ˜¯ a b cã€‚åœ¨è¿›å…¥console.log(â€œbâ€) ä¹‹å‰ï¼Œæ¯«æ— ç–‘é—® r å·²ç»å¾—åˆ°äº†resolveï¼Œä½†æ˜¯Promiseçš„resolveå§‹ç»ˆæ˜¯å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥cæ— æ³•å‡ºç°åœ¨bä¹‹å‰ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯•è¯•è·ŸsetTimeoutæ··ç”¨çš„Promiseã€‚</p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘è®¾ç½®äº†ä¸¤æ®µäº’ä¸ç›¸å¹²çš„å¼‚æ­¥æ“ä½œï¼šé€šè¿‡setTimeoutæ‰§è¡Œconsole.log(â€œdâ€)ï¼Œé€šè¿‡Promiseæ‰§è¡Œconsole.log(â€œcâ€)ã€‚</p><pre><code>    var r = new Promise(function(resolve, reject){
        console.log(&quot;a&quot;);
        resolve()
    });
    setTimeout(()=&gt;console.log(&quot;d&quot;), 0)
    r.then(() =&gt; console.log(&quot;c&quot;));
    console.log(&quot;b&quot;)
</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œä¸è®ºä»£ç é¡ºåºå¦‚ä½•ï¼Œdå¿…å®šå‘ç”Ÿåœ¨cä¹‹åï¼Œå› ä¸ºPromiseäº§ç”Ÿçš„æ˜¯JavaScriptå¼•æ“å†…éƒ¨çš„å¾®ä»»åŠ¡ï¼Œè€ŒsetTimeoutæ˜¯æµè§ˆå™¨APIï¼Œå®ƒäº§ç”Ÿå®ä»»åŠ¡ã€‚</p><p>ä¸ºäº†ç†è§£å¾®ä»»åŠ¡å§‹ç»ˆå…ˆäºå®ä»»åŠ¡ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå®éªŒï¼šæ‰§è¡Œä¸€ä¸ªè€—æ—¶1ç§’çš„Promiseã€‚</p><pre><code>    setTimeout(()=&gt;console.log(&quot;d&quot;), 0)
    var r = new Promise(function(resolve, reject){
        resolve()
    });
    r.then(() =&gt; { 
        var begin = Date.now();
        while(Date.now() - begin &lt; 1000);
        console.log(&quot;c1&quot;) 
        new Promise(function(resolve, reject){
            resolve()
        }).then(() =&gt; console.log(&quot;c2&quot;))
    });
</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¼ºåˆ¶äº†1ç§’çš„æ‰§è¡Œè€—æ—¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä»»åŠ¡c2æ˜¯åœ¨dä¹‹åè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿è€—æ—¶ä¸€ç§’çš„c1æ‰§è¡Œå®Œæ¯•ï¼Œå†enqueçš„c2ï¼Œä»ç„¶å…ˆäºdæ‰§è¡Œäº†ï¼Œè¿™å¾ˆå¥½åœ°è§£é‡Šäº†å¾®ä»»åŠ¡ä¼˜å…ˆçš„åŸç†ã€‚</p><p>é€šè¿‡ä¸€ç³»åˆ—çš„å®éªŒï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹å¦‚ä½•åˆ†æå¼‚æ­¥æ‰§è¡Œçš„é¡ºåºï¼š</p><ul>
<li>é¦–å…ˆæˆ‘ä»¬åˆ†ææœ‰å¤šå°‘ä¸ªå®ä»»åŠ¡ï¼›</li>
<li>åœ¨æ¯ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†ææœ‰å¤šå°‘ä¸ªå¾®ä»»åŠ¡ï¼›</li>
<li>æ ¹æ®è°ƒç”¨æ¬¡åºï¼Œç¡®å®šå®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡æ‰§è¡Œæ¬¡åºï¼›</li>
<li>æ ¹æ®å®ä»»åŠ¡çš„è§¦å‘è§„åˆ™å’Œè°ƒç”¨æ¬¡åºï¼Œç¡®å®šå®ä»»åŠ¡çš„æ‰§è¡Œæ¬¡åºï¼›</li>
<li>ç¡®å®šæ•´ä¸ªé¡ºåºã€‚</li>
</ul><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼š</p><pre><code>    function sleep(duration) {
        return new Promise(function(resolve, reject) {
            console.log(&quot;b&quot;);
            setTimeout(resolve,duration);
        })
    }
    console.log(&quot;a&quot;);
    sleep(5000).then(()=&gt;console.log(&quot;c&quot;));
</code></pre><p>è¿™æ˜¯ä¸€æ®µéå¸¸å¸¸ç”¨çš„å°è£…æ–¹æ³•ï¼Œåˆ©ç”¨PromiseæŠŠsetTimeoutå°è£…æˆå¯ä»¥ç”¨äºå¼‚æ­¥çš„å‡½æ•°ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ï¼ŒsetTimeoutæŠŠæ•´ä¸ªä»£ç åˆ†å‰²æˆäº†2ä¸ªå®è§‚ä»»åŠ¡ï¼Œè¿™é‡Œä¸è®ºæ˜¯5ç§’è¿˜æ˜¯0ç§’ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>ç¬¬ä¸€ä¸ªå®è§‚ä»»åŠ¡ä¸­ï¼ŒåŒ…å«äº†å…ˆååŒæ­¥æ‰§è¡Œçš„ console.log(â€œaâ€); å’Œ console.log(â€œbâ€);ã€‚</p><p>setTimeoutåï¼Œç¬¬äºŒä¸ªå®è§‚ä»»åŠ¡æ‰§è¡Œè°ƒç”¨äº†resolveï¼Œç„¶åthenä¸­çš„ä»£ç å¼‚æ­¥å¾—åˆ°æ‰§è¡Œï¼Œæ‰€ä»¥è°ƒç”¨äº†console.log(â€œcâ€)ï¼Œæœ€ç»ˆè¾“å‡ºçš„é¡ºåºæ‰æ˜¯ï¼š a b cã€‚</p><p>Promiseæ˜¯JavaScriptä¸­çš„ä¸€ä¸ªå®šä¹‰ï¼Œä½†æ˜¯å®é™…ç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ƒä¼¼ä¹å¹¶ä¸æ¯”å›è°ƒçš„æ–¹å¼ä¹¦å†™æ›´ç®€å•ï¼Œä½†æ˜¯ä»ES6å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰äº†async/awaitï¼Œè¿™ä¸ªè¯­æ³•æ”¹è¿›è·ŸPromiseé…åˆï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ”¹å–„ä»£ç ç»“æ„ã€‚</p><h2>æ–°ç‰¹æ€§ï¼šasync/await</h2><p>async/awaitæ˜¯ES2016æ–°åŠ å…¥çš„ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ç”¨forã€ifç­‰ä»£ç ç»“æ„æ¥ç¼–å†™å¼‚æ­¥çš„æ–¹å¼ã€‚å®ƒçš„è¿è¡Œæ—¶åŸºç¡€æ˜¯Promiseï¼Œé¢å¯¹è¿™ç§æ¯”è¾ƒæ–°çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŸºæœ¬ç”¨æ³•ã€‚</p><p>asyncå‡½æ•°å¿…å®šè¿”å›Promiseï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰è¿”å›Promiseçš„å‡½æ•°éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å¼‚æ­¥å‡½æ•°ã€‚</p><p>asyncå‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œç‰¹å¾æ˜¯åœ¨functionå…³é”®å­—ä¹‹å‰åŠ ä¸Šasyncå…³é”®å­—ï¼Œè¿™æ ·ï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªasyncå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨awaitæ¥ç­‰å¾…ä¸€ä¸ªPromiseã€‚</p><pre><code>function sleep(duration) {
    return new Promise(function(resolve, reject) {
        setTimeout(resolve,duration);
    })
}
async function foo(){
    console.log(&quot;a&quot;)
    await sleep(2000)
    console.log(&quot;b&quot;)
}
</code></pre><p>è¿™æ®µä»£ç åˆ©ç”¨äº†æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„sleepå‡½æ•°ã€‚åœ¨å¼‚æ­¥å‡½æ•°fooä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨sleepã€‚</p><p>asyncå‡½æ•°å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯å¯ä»¥åµŒå¥—çš„ã€‚æˆ‘ä»¬åœ¨å®šä¹‰äº†ä¸€æ‰¹åŸå­æ“ä½œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨asyncå‡½æ•°ç»„åˆå‡ºæ–°çš„asyncå‡½æ•°ã€‚</p><pre><code>function sleep(duration) {
    return new Promise(function(resolve, reject) {
        setTimeout(resolve,duration);
    })
}
async function foo(name){
    await sleep(2000)
    console.log(name)
}
async function foo2(){
    await foo(&quot;a&quot;);
    await foo(&quot;b&quot;);
}
</code></pre><p>è¿™é‡Œfoo2ç”¨awaitè°ƒç”¨äº†ä¸¤æ¬¡å¼‚æ­¥å‡½æ•°fooï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬æŠŠsleepè¿™æ ·çš„å¼‚æ­¥æ“ä½œæ”¾å…¥æŸä¸€ä¸ªæ¡†æ¶æˆ–è€…åº“ä¸­ï¼Œä½¿ç”¨è€…å‡ ä¹ä¸éœ€è¦äº†è§£Promiseçš„æ¦‚å¿µå³å¯è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹äº†ã€‚</p><p>æ­¤å¤–ï¼Œgenerator/iteratorä¹Ÿå¸¸å¸¸è¢«è·Ÿå¼‚æ­¥ä¸€èµ·æ¥è®²ï¼Œæˆ‘ä»¬å¿…é¡»è¯´æ˜ generator/iterator å¹¶éå¼‚æ­¥ä»£ç ï¼Œåªæ˜¯åœ¨ç¼ºå°‘async/awaitçš„æ—¶å€™ï¼Œä¸€äº›æ¡†æ¶ï¼ˆæœ€è‘—åçš„è¦æ•°coï¼‰ä½¿ç”¨è¿™æ ·çš„ç‰¹æ€§æ¥æ¨¡æ‹Ÿasync/awaitã€‚</p><p>ä½†æ˜¯generatorå¹¶éè¢«è®¾è®¡æˆå®ç°å¼‚æ­¥ï¼Œæ‰€ä»¥æœ‰äº†async/awaitä¹‹åï¼Œgenerator/iteratoræ¥æ¨¡æ‹Ÿå¼‚æ­¥çš„æ–¹æ³•åº”è¯¥è¢«åºŸå¼ƒã€‚</p><h2>ç»“è¯­</h2><p>åœ¨ä»Šå¤©çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†JavaScriptæ‰§è¡Œéƒ¨åˆ†çš„çŸ¥è¯†ï¼Œé¦–å…ˆæˆ‘ä»¬å­¦ä¹ äº†JavaScriptçš„å®è§‚ä»»åŠ¡å’Œå¾®è§‚ä»»åŠ¡ç›¸å…³çš„çŸ¥è¯†ã€‚æˆ‘ä»¬æŠŠå®¿ä¸»å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå®è§‚ä»»åŠ¡ï¼ŒæŠŠJavaScriptå¼•æ“å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå¾®è§‚ä»»åŠ¡ã€‚è®¸å¤šçš„å¾®è§‚ä»»åŠ¡çš„é˜Ÿåˆ—ç»„æˆäº†å®è§‚ä»»åŠ¡ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å±•å¼€ä»‹ç»äº†ç”¨Promiseæ¥æ·»åŠ å¾®è§‚ä»»åŠ¡çš„æ–¹å¼ï¼Œå¹¶ä¸”ä»‹ç»äº†async/awaitè¿™ä¸ªè¯­æ³•çš„æ”¹è¿›ã€‚</p><p>æœ€åï¼Œç•™ç»™ä½ ä¸€ä¸ªå°ç»ƒä¹ ï¼šæˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªçº¢ç»¿ç¯ï¼ŒæŠŠä¸€ä¸ªåœ†å½¢divæŒ‰ç…§ç»¿è‰²3ç§’ï¼Œé»„è‰²1ç§’ï¼Œçº¢è‰²2ç§’å¾ªç¯æ”¹å˜èƒŒæ™¯è‰²ï¼Œä½ ä¼šæ€æ ·ç¼–å†™è¿™ä¸ªä»£ç å‘¢ï¼Ÿæ¬¢è¿ä½ ç•™è¨€è®¨è®ºã€‚</p><p></p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/04/b3/3f0b69f9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ¨å­¦èŒ‚</span>
  </div>
  <div class="_2_QraFYR_0">function sleep(duration){<br>    return new Promise(function(resolve){<br>        setTimeout(resolve, duration);<br>    })<br>}<br>async function changeColor(duration,color){<br>    document.getElementById(&quot;traffic-light&quot;).style.background = color;<br>    await sleep(duration);<br><br>}<br>async function main(){<br>    while(true){<br>        await changeColor(3000,&quot;green&quot;);<br>        await changeColor(1000, &quot;yellow&quot;);<br>        await changeColor(2000, &quot;red&quot;);<br>    }<br>}<br>main()</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸ªå†™çš„å®Œå…¨æŒ‘ä¸å‡ºæ¯›ç—…ï¼Œå…¶å®ƒåŒå­¦å¯ä»¥å‚è€ƒã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-23 12:35:37</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/2e/64/10182523.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>whatever</span>
  </div>
  <div class="_2_QraFYR_0">https:&#47;&#47;jakearchibald.com&#47;2015&#47;tasks-microtasks-queues-and-schedules&#47;<br>ä¸ºäº†æ›´æ·±å…¥çš„ç†è§£å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œè¯»äº†è¿™ç¯‡ã€‚æ„Ÿè§‰æ–‡ä¸­è¯´çš„å¾®ä»»åŠ¡æ€»æ˜¯å…ˆäºå®ä»»åŠ¡ä¼šè®©äººäº§ç”Ÿè¯¯è§£ï¼Œæ›´å‡†ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯å¾®ä»»åŠ¡æ€»ä¼šåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰æ‰§è¡Œï¼Œåœ¨æœ¬èº«æ‰€å±çš„å®ä»»åŠ¡ç»“æŸåç«‹å³æ‰§è¡Œã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-02 15:59:42</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1e/80/c3/82923c17.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é©¬å…‹è±š</span>
  </div>
  <div class="_2_QraFYR_0">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºå…¶å®å¾ˆå¥½ç†è§£ã€‚é¦–å…ˆä¸€ä¸ªjsè„šæœ¬æœ¬èº«å¯¹äºæµè§ˆå™¨è€Œè¨€å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè€Œå¤„äºå…¶ä¸­çš„ä»£ç å¯èƒ½æœ‰3ç§ï¼šéå¼‚æ­¥ä»£ç ã€äº§ç”Ÿå¾®ä»»åŠ¡çš„å¼‚æ­¥ä»£ç ï¼ˆpromiseç­‰ï¼‰ã€äº§ç”Ÿå®ä»»åŠ¡çš„å¼‚æ­¥ä»£ç (settimeoutã€setintervalç­‰)ã€‚<br>æˆ‘ä»¬çŸ¥é“å®ä»»åŠ¡å¤„äºä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåº”å½“å…ˆæ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ‰€ä»¥åœ¨jsè„šæœ¬ä¸­ï¼Œä¼šå…ˆæ‰§è¡Œéå¼‚æ­¥ä»£ç ï¼Œå†æ‰§è¡Œå¾®ä»»åŠ¡ä»£ç ï¼Œæœ€åæ‰§è¡Œå®ä»»åŠ¡ä»£ç ã€‚è¿™æ—¶å€™æˆ‘ä»¬è¿›è¡Œåˆ°äº†ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼ŒåˆæŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰§è¡Œã€‚<br>å¾®ä»»åŠ¡æ€»æ˜¯å…ˆäºå®ä»»åŠ¡è¿™ä¸ªè¯´æ³•ä¸å‡†ç¡®ï¼Œåº”è¯¥æ˜¯å¤„äºåŒä¸€çº§çš„æƒ…å†µä¸‹æ‰èƒ½è¿™ä¹ˆè¯´ã€‚å®é™…ä¸Šå¾®ä»»åŠ¡æ°¸è¿œæ˜¯å®ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¤„äºä¸€ä¸ªå¤§çš„å®ä»»åŠ¡å†…ã€‚<br><br><br></div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-06-16 19:33:42</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/29/39/0aec7827.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è´¹é©¬</span>
  </div>
  <div class="_2_QraFYR_0">const lightEle = document.getElementById(&#39;traffic-light&#39;);<br>function changeTrafficLight(color, duration) {<br>  return new Promise(function(resolve, reject) {<br>    lightEle.style.background = color;<br>    setTimeout(resolve, duration);<br>  })<br>}<br><br>async function trafficScheduler() {<br>  await changeTrafficLight(&#39;green&#39;, 3000);<br>  await changeTrafficLight(&#39;yellow&#39;, 1000);<br>  await changeTrafficLight(&#39;red&#39;, 2000);<br>  trafficScheduler();<br>}<br><br>trafficScheduler();</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸ªå†™çš„ä¸é”™ï¼Œä¸è¿‡ï¼Œæ—¢ç„¶éƒ½ç”¨åˆ°äº†awaitï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨é€’å½’å‘¢ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-23 09:26:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/cb/82/d01f40b4.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>deiphi</span>
  </div>
  <div class="_2_QraFYR_0">&#47;&#47; æ¯”è¾ƒåŸå§‹çš„å†™æ³•<br>function color () { <br>	console.log(&#39;green&#39;);<br>	<br>	setTimeout(() =&gt; {<br>			console.log(&#39;yellow&#39;);<br>			<br>			setTimeout(() =&gt; {<br>				console.log(&#39;red&#39;);<br>				<br>				setTimeout(color, 2000);<br>			}, 1000)<br>	}, 3000);<br>}<br>color();</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å“ˆå“ˆå“ˆ è¿™ä¸ªç¡¬æ ¸äº†å•Šâ€¦â€¦  ç»“æœå€’æ˜¯å¯¹çš„<br><br>ä¸è¯•è¯•Promiseå—ï¼Ÿ æˆ‘è®²äº†è¿™ä¹ˆå¤šå‘¢â€¦â€¦</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-26 22:05:57</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/be/e2/57d62270.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¥‡å¥‡</span>
  </div>
  <div class="_2_QraFYR_0">æ€ä¹ˆåŒºåˆ†æ˜¯å®¿ä¸»ç¯å¢ƒè¿˜æ˜¯jså¼•æ“å‘èµ·çš„ä»»åŠ¡å‘¢</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-28 08:51:40</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/s0bx4WXQNkAJ3c3map0g6dlt3sKDgTtN7Ria96YoufjQcVVI8Shv5CN1jnK1ZTImNnlPcibRqvyiaUuhpIvV1TpnQ/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>wingsico</span>
  </div>
  <div class="_2_QraFYR_0">è¿™ä¸€èŠ‚ä¸»è¦è®²äº†ä¸€ä¸‹JSçš„æ‰§è¡Œæ ˆï¼Œä»å®¿ä¸»ç¯å¢ƒåˆ°JSå¼•æ“ï¼Œåˆ†ä¸ºå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ã€‚ä½†å®é™…ä¸Šå¹¶æ²¡æœ‰é˜è¿°çš„ååˆ†æ¸…æ¥šï¼Œåªæ˜¯æ ¹æ®ä¸€äº›æ¯”è¾ƒæµ…æ˜¾çš„ç°è±¡æ¥è¯´æ˜äº†ä¸€ä¸‹è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œæœºåˆ¶ã€‚<br><br>å¯¹äºä¸ºä»€ä¹ˆé‡‡ç”¨äº‹ä»¶å¾ªç¯ï¼Œä»¥åŠå¤šç§å®ä»»åŠ¡é˜Ÿåˆ—ä»¥åŠæµè§ˆå™¨æ¸²æŸ“ï¼ŒIOï¼Œç½‘ç»œè¯·æ±‚ç­‰å‡æ— æ¶‰åŠã€‚<br><br>å®é™…ä¸Šäº‹ä»¶å¾ªç¯ä¾èµ–äºå®¿ä¸»ï¼Œæ˜¯å®¿ä¸»éœ€è¦äº‹ä»¶å¾ªç¯æ¥åè°ƒjsä¸­å¤šç§äº‹ä»¶æºè¿›è¡Œäº¤äº’ã€‚è€Œäº‹ä»¶å¾ªç¯å¹¶ä¸æ˜¯jsæœ¬èº«å…·æœ‰çš„èƒ½åŠ›ã€‚<br><br>å¯¹äºæµè§ˆå™¨ä¸­çš„å¤šç§çš„å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯åˆ†ä¸ºé¡µé¢æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’ã€ç½‘ç»œè¯·æ±‚ã€History APIä»¥åŠè®¡æ—¶å™¨ç­‰ï¼Œä¸åŒç§ç±»çš„å®ä»»åŠ¡é˜Ÿåˆ—ä¹‹é—´çš„ä¼˜å…ˆçº§ä¸åŒï¼Œä¹Ÿè·Ÿå®é™…æ‰§è¡Œçš„æ—¶æœºæœ‰å…³ï¼Œä¸åŒæ—¶æœºå¾—åˆ°çš„ç»“æœä¹Ÿä¼šä¸åŒã€‚<br><br>è€Œæµè§ˆå™¨ä¸­çš„äº‹ä»¶å¾ªç¯ä¸Nodeä¸­çš„äº‹ä»¶å¾ªç¯ä¹Ÿæœ‰åŒºåˆ«ï¼ˆåŸå› ä¸Šé¢è¯´äº†ï¼‰ï¼ŒNodeä¸­æ²¡æœ‰DOMï¼Œæ²¡æœ‰é¡µé¢æ¸²æŸ“ï¼Œä½†å¤šäº†æ–‡ä»¶è¯»å–ç­‰ã€‚åœ¨Node11ä¹‹å‰ï¼ŒNodeä¸­ä¸€æ¬¡äº‹ä»¶å¾ªç¯å¯ä»¥æ‰§è¡Œå®Œæ‰€æœ‰å®ä»»åŠ¡åå†è¿›å…¥ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯ã€‚åœ¨Nodeä¸­ï¼Œå„ç§ä¸åŒçš„å®ä»»åŠ¡ä¹‹é—´ä¹Ÿæœ‰ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”æ˜¯å›ºå®šçš„ï¼Œä½†è·Ÿæ‰§è¡Œçš„æ—¶æœºä¹Ÿæœ‰å…³ç³»ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿç»å¸¸çœ‹åˆ°é‡å¤æ‰§è¡Œä¸€æ®µä»£ç ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœã€‚ä½†å…·ä½“çš„ä¸€ä¸ªè¿ä½œæœºåˆ¶æˆ‘ç›®å‰ä»ç„¶æ²¡æœ‰ææ¸…æ¥šï¼Œç¿»çœ‹äº†å¾ˆå¤šèµ„æ–™ä¹Ÿæ²¡æœ‰å¯¹è¿™éƒ¨åˆ†æœ‰ç€è¯¦ç»†çš„é˜è¿°ã€‚<br><br></div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-04-06 14:40:11</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/8b/7e/f78e86a8.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é¡¾ç›¼ç¥é£ğŸ‘»</span>
  </div>
  <div class="_2_QraFYR_0">js ç‰ˆæœ¬ æœ€é«˜èµåŒå­¦å¤Ÿæ ‡å‡† æ¥ä¸ª css ç‰ˆæœ¬ å“ˆå“ˆ<br>&lt;div class=&quot;toggle-color&quot;&gt;&lt;&#47;div&gt;<br>.toggle-color {<br>			width: 100px;<br>			height: 100px;<br>			animation: toggle_color linear 6s infinite<br>		}<br><br>		@keyframes toggle_color {<br><br>			0%,<br>			50% {<br>				background: green<br>			}<br><br>			51%,<br>			67% {<br>				background: yellow<br>			}<br><br>			68%,<br>			100% {<br>				background: red<br>			}<br>		}</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-04-02 15:41:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/4a/13/42e02b09.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è®¸å‰ä¸­</span>
  </div>
  <div class="_2_QraFYR_0">async&#47;awaitå‡½æ•°å±äºå®è§‚è¿˜æ˜¯å¾®è§‚ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å®ƒäº§ç”ŸPromiseï¼Œå½“ç„¶æ˜¯å¾®è§‚ä»»åŠ¡äº†</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-24 13:18:24</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/0e/04/d710d928.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¥¥æ–¯ç‰¹æ´›å¤«æ–¯åŸº</span>
  </div>
  <div class="_2_QraFYR_0">åŒæ­¥çš„ä»£ç å’ŒsetTimeoutéƒ½æ˜¯å®ä»»åŠ¡ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åº”è¯¥è¯´ä¸€ä¸ªscriptæ ‡ç­¾æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-26 17:55:16</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/16/6f/60/edbb8b8a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°å­”</span>
  </div>
  <div class="_2_QraFYR_0">1. async&#47;await ï¼Œé‡åˆ°awaitæ—¶å°±ä¼šé€€å‡ºæ‰§è¡Œï¼Œæˆ‘æƒ³é—®ä¸‹ï¼Œé€€å‡ºä¹‹åæ˜¯å¤„äºç­‰å¾…awaitæ‰§è¡Œå®Œå†å¼€å§‹ä¹‹åå—ï¼Ÿ<br>2. å¦‚æœpromiseä¸­äº§ç”ŸsetTimeoutå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œçš„setTimeoutæ˜¯å¤„äºå¾®è§‚ä»»åŠ¡å¯¹å—ï¼Ÿå› ä¸ºè¿™æ˜¯jså¼•æ“ç›´æ¥å‘èµ·çš„ï¼Ÿ<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: 1. å¯¹<br>2. è¿˜æ˜¯å®è§‚ä»»åŠ¡ï¼Œå› ä¸ºä½ è°ƒç”¨åˆ°äº†å¼•æ“ä»¥å¤–çš„APIå‘€</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-09 11:28:10</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/16/8e/7f/4ff4472f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>CaveShao</span>
  </div>
  <div class="_2_QraFYR_0">   function func(color, duration) {<br>        return new Promise(function(resolve, reject) {<br>            light.style.backgroundColor = color;<br>            setTimeout(function() {<br>                it.next();<br>            }, duration)<br>        })<br>    }<br><br>    function* main() {<br>        while (1) {<br>            yield func(&#39;red&#39;,2000);<br>            yield func(&#39;yellow&#39;,1000);<br>            yield func(&#39;green&#39;,3000);<br>        }<br>    }<br><br>    var it = main();<br>    it.next();</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-05-15 13:06:24</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/98/f7/abb7bfe3.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¸…æ°”å°ç†ŠçŒ«</span>
  </div>
  <div class="_2_QraFYR_0">æ€ä¹ˆç¡®å®šè¿™ä¸ªå¾®ä»»åŠ¡å±äºä¸€ä¸ªå®ä»»åŠ¡å‘¢ï¼Œjsä¸»çº¿ç¨‹è·‘ä¸‹æ¥ï¼Œé‡åˆ°setTImeoutä¼šæ”¾åˆ°å¼‚æ­¥é˜Ÿåˆ—å®ä»»åŠ¡ä¸­ï¼Œé‚£ä¸‹é¢çš„é‡åˆ°çš„promiseæ€ä¹ˆåˆ¤æ–­å‡ºå®ƒæ˜¯å±äºè¿™ä¸ªå®ä»»åŠ¡å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åªæœ‰è¿™ä¸ªå®ä»»åŠ¡æ²¡æœ‰ä»å¼‚æ­¥é˜Ÿåˆ—ä¸­å–å‡ºï¼Œä¸­é—´æ‰€ç¢°åˆ°çš„æ‰€æœ‰å¾®ä»»åŠ¡éƒ½å±äºè¿™ä¸ªå®ä»»åŠ¡ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-22 08:37:37</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/49/e4/fb47bfcd.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>dellyoung</span>
  </div>
  <div class="_2_QraFYR_0">15è¡Œä»£ç æœ€ç®€å®ç°ï¼š<br>const changeNowColor = (time) =&gt; {<br>    setTimeout(() =&gt; {<br>        switch (document.getElementById(&#39;root&#39;).style.background) {<br>            case &#39;green&#39;:<br>                document.getElementById(&#39;root&#39;).style.background = &#39;yellow&#39;;<br>                return changeNowColor(1000);<br>            case &#39;yellow&#39;:<br>                document.getElementById(&#39;root&#39;).style.background = &#39;red&#39;;<br>                return changeNowColor(2000);<br>            case &#39;red&#39;:<br>                document.getElementById(&#39;root&#39;).style.background = &#39;green&#39;;<br>                return changeNowColor(3000);<br>        }<br>    }, time);<br>};<br>changeNowColor(3000);</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-09-08 00:36:22</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/f7/d9/3014889f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å‘¨åºçŒ¿</span>
  </div>
  <div class="_2_QraFYR_0">&#47;&#47; å¦ç±»çš„å†™æ³•<br> var lightDiv = document.getElementById(&#39;light&#39;)<br>    function wait(seconds){<br>      return new Promise((resolve)=&gt;{<br>        setTimeout(resolve,seconds)<br>      })<br>    }<br><br>    function light(color, waitTime){<br>      this.color = color<br>      this.waitTime = waitTime<br>    }<br>    light.prototype.run = function(){<br>      lightDiv.style.backgroundColor = this.color<br>      return wait(this.waitTime).then(()=&gt;{<br>        return this.nextLight.run()<br>      })<br>    }<br><br>    let redLight = new light(&#39;red&#39;,2000)<br>    let yellowLight = new light(&#39;yellow&#39;,1000)<br>    let greenLight = new light(&#39;green&#39;,3000)<br><br>    redLight.nextLight = greenLight<br>    yellowLight.nextLight = redLight<br>    greenLight.nextLight = yellowLight<br><br>    redLight.run()</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é¢ è¿™ä¸ªç»“æœæ˜¯å¯¹çš„ ä¸è¿‡å°è£…æˆè¿™æ · åˆé€‚å—ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-26 14:13:03</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è®¸ç«¥ç«¥</span>
  </div>
  <div class="_2_QraFYR_0">async function controlLoop () {<br>  await changeColor(&#39;green&#39;, 3000)<br>  await changeColor(&#39;yellow&#39;, 1000)<br>  await changeColor(&#39;red&#39;, 2000)<br>  await controlLoop()<br>}<br><br>async function changeColor (color, time) {<br>  console.log(color + &#39; begin&#39;)<br>  return new Promise((resolve) =&gt; {<br>    setTimeout(() =&gt; {<br>      console.log(color + &#39; end&#39;)<br>      resolve()<br>    }, time)<br>  })<br>}<br><br>controlLoop()</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä½ è¿™ä¸ªæœ‰ç‚¹é—®é¢˜ï¼Œæ‰§è¡Œå¤šäº†å¯èƒ½çˆ†æ ˆï¼Œæ”¹æ”¹è¯•è¯•ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-23 12:27:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9c/e2/368f6734.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³</span>
  </div>
  <div class="_2_QraFYR_0">async&#47;awiat åªæ˜¯generator&#47;iteratorçš„è¯­æ³•ç³–è€Œå·²</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸æ˜¯èƒ¡è¯´å‘¢ä¹ˆã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-07-08 15:22:19</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/dc/0b/0baff83d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ‹’ç»ç¬¬åä¸ƒæ¬¡ğŸ¤¤</span>
  </div>
  <div class="_2_QraFYR_0">    let sleep = (color,deep)=&gt;{<br>      return new Promise(reslove=&gt;{<br>        setTimeout(()=&gt;reslove(color) ,deep)<br>      })<br>    }<br>    async function  changColor (color){<br>      await sleep (&#39;green&#39;,3000),<br>      await sleep (&#39;yellow&#39;,1000)<br>      await sleep (&#39;red&#39;,2000)<br>    }<br>    changColor();</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-10 21:32:57</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/be/22/8bb1640f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>oillie</span>
  </div>
  <div class="_2_QraFYR_0">ä¸€ä¸ªå®ä»»åŠ¡åŒ…å«ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Ÿè¿˜æ˜¯ä¸€ä¸ªevent loopé‡Œåªæœ‰ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè™½ç„¶ä¸å½±å“å®é™…æ•ˆæœï¼Œä½†è¿˜æ˜¯æƒ³ç¡®è®¤ä¸‹..</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-02 19:12:44</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJEPMj69Hy9qq8SuEsiccKKaJQt20vvjl9Z9DMJxNmvrq6X3LrDMONTT6Jkg70kEVg13Lkdc6eMWlA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_e21f0d</span>
  </div>
  <div class="_2_QraFYR_0">let lightStates = [{<br>        color: &#39;green&#39;,<br>        duration: 3000<br>    },<br>    {<br>        color: &#39;yellow&#39;,<br>        duration: 1000<br>    },<br>    {<br>        color: &#39;red&#39;,<br>        duration: 2000<br>    }];<br>    let setLightColorAndVisibleDuration = function(color, duration) {<br>        &#47;&#47;set light color<br>        return new Promise((resolve) =&gt; {<br>            setTimeout(() =&gt; {<br>                resolve();<br>            }, duration);<br>        });<br>    }<br>    let startShowLight = async function() {<br>        let index = 0;<br>        while(index &lt;= lightStates.length - 1) {<br>            let nextState = lightStates[index];<br>            await setLightColorAndVisibleDuration(nextState.color, nextState.duration);<br>            index++;<br>        }<br>        <br>    };<br>    startShowLight();</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å°è£…ä¸æ˜¯è¶Šå¤æ‚è¶Šå¥½ï¼Œå¤ªå¤æ‚äº†è¿˜ä¸å¦‚ç›´æ¥setTimeoutäº†</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-02-26 22:20:39</div>
  </div>
</div>
</div>
</li>
</ul>