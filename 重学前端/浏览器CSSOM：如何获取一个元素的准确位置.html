<audio title="æµè§ˆå™¨CSSOMï¼šå¦‚ä½•è·å–ä¸€ä¸ªå…ƒç´ çš„å‡†ç¡®ä½ç½®" src="https://static001.geekbang.org/resource/audio/a9/05/a9d778787d19d67bb2d2d04e00215605.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯winterã€‚</p><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†DOMç›¸å…³çš„APIï¼Œç‹­ä¹‰çš„DOM APIä»…ä»…åŒ…å«DOMæ ‘å½¢ç»“æ„ç›¸å…³çš„å†…å®¹ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å†æ¥å­¦ä¹ ä¸€ç±»æ–°çš„APIï¼šCSSOMã€‚</p><p>æˆ‘æƒ³ï¼Œä½ åœ¨æœ€åˆæ¥è§¦æµè§ˆå™¨APIçš„æ—¶å€™ï¼Œåº”è¯¥éƒ½æœ‰è·Ÿæˆ‘ç±»ä¼¼çš„æƒ³æ³•ï¼šâ€œå¥½æƒ³è¦element.widthã€element.heightè¿™æ ·çš„APIå•Šâ€ã€‚</p><p>è¿™æ ·çš„APIå¯ä»¥ç›´æ¥è·å–å…ƒç´ çš„æ˜¾ç¤ºç›¸å…³ä¿¡æ¯ï¼Œå®ƒä»¬æ˜¯éå¸¸ç¬¦åˆäººçš„ç¬¬ä¸€å°è±¡ç›´è§‰çš„è®¾è®¡ï¼Œä½†æ˜¯ï¼Œåå DOM API ä¸­æ²¡æœ‰è¿™æ ·çš„å†…å®¹ã€‚</p><p>éšç€å­¦ä¹ çš„æ·±å…¥ï¼Œæˆ‘æ‰çŸ¥é“ï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯æœ‰èƒŒåçš„é€»è¾‘çš„ï¼Œæ­£å¦‚HTMLå’ŒCSSåˆ†åˆ«æ‰¿æ‹…äº†è¯­ä¹‰å’Œè¡¨ç°çš„åˆ†å·¥ï¼ŒDOMå’ŒCSSOMä¹Ÿæœ‰è¯­ä¹‰å’Œè¡¨ç°çš„åˆ†å·¥ã€‚</p><p>DOMä¸­çš„æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç”¨æ¥è¡¨ç°è¯­ä¹‰çš„å±æ€§ï¼ŒCSSOMçš„åˆ™éƒ½æ˜¯è¡¨ç°çš„å±æ€§ï¼Œwidthå’Œheightè¿™ç±»æ˜¾ç¤ºç›¸å…³çš„å±æ€§ï¼Œéƒ½å±äºæˆ‘ä»¬ä»Šå¤©è¦è®²çš„CSSOMã€‚</p><p>é¡¾åæ€ä¹‰ï¼ŒCSSOMæ˜¯CSSçš„å¯¹è±¡æ¨¡å‹ï¼Œåœ¨W3Cæ ‡å‡†ä¸­ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šæè¿°æ ·å¼è¡¨å’Œè§„åˆ™ç­‰CSSçš„æ¨¡å‹éƒ¨åˆ†ï¼ˆCSSOMï¼‰ï¼Œå’Œè·Ÿå…ƒç´ è§†å›¾ç›¸å…³çš„Viewéƒ¨åˆ†ï¼ˆCSSOM Viewï¼‰ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒCSSOM Viewæ¯”CSSOMæ›´å¸¸ç”¨ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå°‘éœ€è¦ç”¨ä»£ç å»åŠ¨æ€åœ°ç®¡ç†æ ·å¼è¡¨ã€‚</p><!-- [[[read_end]]] --><p>åœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘æ¥åˆ†åˆ«ä¸ºä½ ä»‹ç»è¿™ä¸¤éƒ¨åˆ†çš„APIã€‚</p><h2>CSSOM</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸‹CSSä¸­æ ·å¼è¡¨çš„æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯CSSOMçš„æœ¬ä½“ã€‚</p><p>æˆ‘ä»¬é€šå¸¸åˆ›å»ºæ ·å¼è¡¨ä¹Ÿéƒ½æ˜¯ä½¿ç”¨HTMLæ ‡ç­¾æ¥åšåˆ°çš„ï¼Œæˆ‘ä»¬ç”¨styleæ ‡ç­¾å’Œlinkæ ‡ç­¾åˆ›å»ºæ ·å¼è¡¨ï¼Œä¾‹å¦‚ï¼š</p><pre><code>&lt;style title=&quot;Hello&quot;&gt;
a {
  color:red;
}
&lt;/style&gt;
&lt;link rel=&quot;stylesheet&quot; title=&quot;x&quot; href=&quot;data:text/css,p%7Bcolor:blue%7D&quot;&gt;
</code></pre><p>æˆ‘ä»¬åˆ›å»ºå¥½æ ·å¼è¡¨åï¼Œè¿˜æœ‰å¯èƒ½è¦å¯¹å®ƒè¿›è¡Œä¸€äº›æ“ä½œã€‚å¦‚æœæˆ‘ä»¬ä»¥DOMçš„è§’åº¦å»ç†è§£çš„è¯ï¼Œè¿™äº›æ ‡ç­¾åœ¨DOMä¸­æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä»¬æœ‰èŠ‚ç‚¹çš„å†…å®¹ã€å±æ€§ï¼Œè¿™ä¸¤ä¸ªæ ‡ç­¾ä¸­ï¼ŒCSSä»£ç æœ‰çš„åœ¨å±æ€§ã€æœ‰çš„åœ¨å­èŠ‚ç‚¹ã€‚è¿™ä¸¤ä¸ªæ ‡ç­¾ä¹Ÿéµå¾ªDOMèŠ‚ç‚¹çš„æ“ä½œè§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨DOM APIå»è®¿é—®ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·åšçš„åæœæ˜¯æˆ‘ä»¬éœ€è¦å»å†™å¾ˆå¤šåˆ†æ”¯é€»è¾‘ï¼Œå¹¶ä¸”ï¼Œè¦æƒ³è§£æCSSä»£ç ç»“æ„ä¹Ÿä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨CSSOM APIå»æ“ä½œå®ƒä»¬ç”Ÿæˆçš„æ ·å¼è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹CSSOM APIçš„åŸºæœ¬ç”¨æ³•ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å–æ–‡æ¡£ä¸­æ‰€æœ‰çš„æ ·å¼è¡¨ï¼š</p><pre><code>document.styleSheets
</code></pre><p>documentçš„styleSheetså±æ€§è¡¨ç¤ºæ–‡æ¡£ä¸­çš„æ‰€æœ‰æ ·å¼è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªåªè¯»çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ä¸‹æ ‡è®¿é—®æ ·å¼è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨itemæ–¹æ³•æ¥è®¿é—®ï¼Œå®ƒæœ‰lengthå±æ€§è¡¨ç¤ºæ–‡æ¡£ä¸­çš„æ ·å¼è¡¨æ•°é‡ã€‚</p><p>æ ·å¼è¡¨åªèƒ½ä½¿ç”¨styleæ ‡ç­¾æˆ–è€…linkæ ‡ç­¾åˆ›å»ºï¼ˆå¯¹XMLæ¥è¯´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<!--?xml-styleSheet ... ?-->ï¼Œå’±ä»¬æš‚ä¸”ä¸è¡¨ï¼‰ã€‚</p><p>æˆ‘ä»¬è™½ç„¶æ— æ³•ç”¨CSSOM APIæ¥åˆ›å»ºæ ·å¼è¡¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æ ·å¼è¡¨ä¸­çš„å†…å®¹ã€‚</p><pre><code class="language-JavaScript">document.styleSheets[0].insertRule("p { color:pink; }", 0)
document.styleSheets[0].removeRule(0)
</code></pre><p>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ ·å¼è¡¨ä¸­ç‰¹å®šçš„è§„åˆ™ï¼ˆRuleï¼‰ï¼Œå¹¶ä¸”å¯¹å®ƒè¿›è¡Œä¸€å®šçš„æ“ä½œï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨å®ƒçš„cssRuleså±æ€§æ¥å®ç°ï¼š</p><pre><code class="language-JavaScript">document.styleSheets[0].cssRules
</code></pre><p>è¿™é‡Œå–åˆ°çš„è§„åˆ™åˆ—è¡¨ï¼ŒåŒæ ·æ˜¯æ”¯æŒitemã€lengthå’Œä¸‹æ ‡è¿ç®—ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œçš„Ruleså¯å°±æ²¡é‚£ä¹ˆç®€å•äº†ï¼Œå®ƒå¯èƒ½æ˜¯CSSçš„at-ruleï¼Œä¹Ÿå¯èƒ½æ˜¯æ™®é€šçš„æ ·å¼è§„åˆ™ã€‚ä¸åŒçš„ruleç±»å‹ï¼Œå…·æœ‰ä¸åŒçš„å±æ€§ã€‚</p><p>æˆ‘ä»¬åœ¨CSSè¯­æ³•éƒ¨åˆ†ï¼Œå·²ç»ä¸ºä½ æ•´ç†è¿‡at-ruleçš„å®Œæ•´åˆ—è¡¨ï¼Œå¤šæ•°at-ruleéƒ½å¯¹åº”ç€ä¸€ä¸ªruleç±»å‹ï¼š</p><ul>
<li>CSSStyleRule</li>
<li>CSSCharsetRule</li>
<li>CSSImportRule</li>
<li>CSSMediaRule</li>
<li>CSSFontFaceRule</li>
<li>CSSPageRule</li>
<li>CSSNamespaceRule</li>
<li>CSSKeyframesRule</li>
<li>CSSKeyframeRule</li>
<li>CSSSupportsRule</li>
</ul><p>å…·ä½“çš„è§„åˆ™æ”¯æŒçš„å±æ€§ï¼Œå»ºè®®ä½ å¯ä»¥ç”¨åˆ°çš„æ—¶å€™ï¼Œå†å»æŸ¥é˜…MDNæˆ–è€…W3Cçš„æ–‡æ¡£ï¼Œåœ¨æˆ‘ä»¬çš„æ–‡ç« ä¸­ï¼Œä»…ä¸ºä½ è¯¦ç»†ä»‹ç»æœ€å¸¸ç”¨çš„ CSSStyleRuleã€‚</p><p>CSSStyleRuleæœ‰ä¸¤ä¸ªå±æ€§ï¼šselectorText å’Œ styleï¼Œåˆ†åˆ«è¡¨ç¤ºä¸€ä¸ªè§„åˆ™çš„é€‰æ‹©å™¨éƒ¨åˆ†å’Œæ ·å¼éƒ¨åˆ†ã€‚</p><p>selectoréƒ¨åˆ†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™é‡Œæ˜¾ç„¶å·æ‡’äº†æ²¡æœ‰è®¾è®¡è¿›ä¸€æ­¥çš„é€‰æ‹©å™¨æ¨¡å‹ï¼Œæˆ‘ä»¬æŒ‰ç…§é€‰æ‹©å™¨è¯­æ³•è®¾ç½®å³å¯ã€‚</p><p>styleéƒ¨åˆ†æ˜¯ä¸€ä¸ªæ ·å¼è¡¨ï¼Œå®ƒè·Ÿæˆ‘ä»¬å…ƒç´ çš„styleå±æ€§æ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒä¿®æ”¹å†…è”æ ·å¼ä¸€æ ·ï¼Œç›´æ¥æ”¹å˜å±æ€§ä¿®æ”¹è§„åˆ™ä¸­çš„å…·ä½“CSSå±æ€§å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨cssTextè¿™æ ·çš„å·¥å…·å±æ€§ã€‚</p><p>æ­¤å¤–ï¼ŒCSSOMè¿˜æä¾›äº†ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼Œæ¥è·å–ä¸€ä¸ªå…ƒç´ æœ€ç»ˆç»è¿‡CSSè®¡ç®—å¾—åˆ°çš„å±æ€§ï¼š</p><pre><code>window.getComputedStyle(elt, pseudoElt);
</code></pre><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬è¦è·å–å±æ€§çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨äºé€‰æ‹©ä¼ªå…ƒç´ ã€‚</p><p>å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CSSOM APIè‡ªç”±åœ°ä¿®æ”¹é¡µé¢å·²ç»ç”Ÿæ•ˆçš„æ ·å¼è¡¨äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·å…³æ³¨ä¸€ä¸‹è§†å›¾çš„é—®é¢˜ã€‚</p><h2>CSSOM View</h2><p>CSSOM View è¿™ä¸€éƒ¨åˆ†çš„APIï¼Œå¯ä»¥è§†ä¸ºDOM APIçš„æ‰©å±•ï¼Œå®ƒåœ¨åŸæœ¬çš„Elementæ¥å£ä¸Šï¼Œæ·»åŠ äº†æ˜¾ç¤ºç›¸å…³çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ï¼Œåˆå¯ä»¥åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šçª—å£éƒ¨åˆ†ï¼Œæ»šåŠ¨éƒ¨åˆ†å’Œå¸ƒå±€éƒ¨åˆ†ï¼Œä¸‹é¢æˆ‘æ¥åˆ†åˆ«å¸¦ä½ äº†è§£ä¸€ä¸‹ã€‚</p><h2>çª—å£ API</h2><p>çª—å£APIç”¨äºæ“ä½œæµè§ˆå™¨çª—å£çš„ä½ç½®ã€å°ºå¯¸ç­‰ã€‚</p><ul>
<li>moveTo(x, y) çª—å£ç§»åŠ¨åˆ°å±å¹•çš„ç‰¹å®šåæ ‡ï¼›</li>
<li>moveBy(x, y) çª—å£ç§»åŠ¨ç‰¹å®šè·ç¦»ï¼›</li>
<li>resizeTo(x, y) æ”¹å˜çª—å£å¤§å°åˆ°ç‰¹å®šå°ºå¯¸ï¼›</li>
<li>resizeBy(x, y) æ”¹å˜çª—å£å¤§å°ç‰¹å®šå°ºå¯¸ã€‚</li>
</ul><p>æ­¤å¤–ï¼Œçª—å£APIè¿˜è§„å®šäº† window.open() çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š</p><pre><code>window.open(&quot;about:blank&quot;, &quot;_blank&quot; ,&quot;width=100,height=100,left=100,right=100&quot; )
</code></pre><p>ä¸€äº›æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘æ²¡æœ‰å®ç°ï¼Œä¹Ÿä¸é€‚ç”¨äºç§»åŠ¨ç«¯æµè§ˆå™¨ï¼Œè¿™éƒ¨åˆ†ä½ ä»…éœ€ç®€å•äº†è§£å³å¯ã€‚ä¸‹é¢æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æ»šåŠ¨APIã€‚</p><h2>æ»šåŠ¨ API</h2><p>è¦æƒ³ç†è§£æ»šåŠ¨ï¼Œé¦–å…ˆæˆ‘ä»¬å¿…é¡»è¦å»ºç«‹ä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨PCæ—¶ä»£ï¼Œæµè§ˆå™¨å¯è§†åŒºåŸŸçš„æ»šåŠ¨å’Œå†…éƒ¨å…ƒç´ çš„æ»šåŠ¨å…³ç³»æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ï¼Œä½†æ˜¯åœ¨ç§»åŠ¨ç«¯è¶Šæ¥è¶Šé‡è¦çš„ä»Šå¤©ï¼Œä¸¤è€…å¿…é¡»åˆ†å¼€çœ‹å¾…ï¼Œä¸¤è€…çš„æ€§èƒ½å’Œè¡Œä¸ºéƒ½æœ‰åŒºåˆ«ã€‚</p><h3>è§†å£æ»šåŠ¨API</h3><p>å¯è§†åŒºåŸŸï¼ˆè§†å£ï¼‰æ»šåŠ¨è¡Œä¸ºç”±windowå¯¹è±¡ä¸Šçš„ä¸€ç»„APIæ§åˆ¶ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ï¼š</p><ul>
<li>scrollX æ˜¯è§†å£çš„å±æ€§ï¼Œè¡¨ç¤ºXæ–¹å‘ä¸Šçš„å½“å‰æ»šåŠ¨è·ç¦»ï¼Œæœ‰åˆ«å pageXOffsetï¼›</li>
<li>scrollY æ˜¯è§†å£çš„å±æ€§ï¼Œè¡¨ç¤ºYæ–¹å‘ä¸Šçš„å½“å‰æ»šåŠ¨è·ç¦»ï¼Œæœ‰åˆ«å pageYOffsetï¼›</li>
<li>scroll(x, y) ä½¿å¾—é¡µé¢æ»šåŠ¨åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œæœ‰åˆ«åscrollToï¼Œæ”¯æŒä¼ å…¥é…ç½®å‹å‚æ•° {top, left}ï¼›</li>
<li>scrollBy(x, y) ä½¿å¾—é¡µé¢æ»šåŠ¨ç‰¹å®šçš„è·ç¦»ï¼Œæ”¯æŒä¼ å…¥é…ç½®å‹å‚æ•° {top, left}ã€‚</li>
</ul><p>é€šè¿‡è¿™äº›å±æ€§å’Œæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–è§†å£çš„æ»šåŠ¨ä½ç½®å’Œæ“çºµè§†å£æ»šåŠ¨ã€‚ä¸è¿‡ï¼Œè¦æƒ³ç›‘å¬è§†å£æ»šåŠ¨äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨documentå¯¹è±¡ä¸Šç»‘å®šäº‹ä»¶ç›‘å¬å‡½æ•°ï¼š</p><pre><code>document.addEventListener(&quot;scroll&quot;, function(event){
  //......
})
</code></pre><p>è§†å£æ»šåŠ¨APIæ˜¯é¡µé¢çš„é¡¶å±‚å®¹å™¨çš„æ»šåŠ¨ï¼Œå¤§éƒ¨åˆ†ç§»åŠ¨ç«¯æµè§ˆå™¨éƒ½ä¼šé‡‡ç”¨ä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå®ƒå’Œå…ƒç´ æ»šåŠ¨ä¸å®Œå…¨ä¸€æ ·ï¼Œè¯·å¤§å®¶ä¸€å®šå»ºç«‹è¿™ä¸ªåŒºåˆ†çš„æ„è¯†ã€‚</p><h3>å…ƒç´ æ»šåŠ¨API</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹å…ƒç´ æ»šåŠ¨APIï¼Œåœ¨Elementç±»ï¼ˆå‚è§DOMéƒ¨åˆ†ï¼‰ï¼Œä¸ºäº†æ”¯æŒæ»šåŠ¨ï¼ŒåŠ å…¥äº†ä»¥ä¸‹APIã€‚</p><ul>
<li>scrollTop å…ƒç´ çš„å±æ€§ï¼Œè¡¨ç¤ºYæ–¹å‘ä¸Šçš„å½“å‰æ»šåŠ¨è·ç¦»ã€‚</li>
<li>scrollLeft å…ƒç´ çš„å±æ€§ï¼Œè¡¨ç¤ºXæ–¹å‘ä¸Šçš„å½“å‰æ»šåŠ¨è·ç¦»ã€‚</li>
<li>scrollWidth å…ƒç´ çš„å±æ€§ï¼Œè¡¨ç¤ºå…ƒç´ å†…éƒ¨çš„æ»šåŠ¨å†…å®¹çš„å®½åº¦ï¼Œä¸€èˆ¬æ¥è¯´ä¼šå¤§äºç­‰äºå…ƒç´ å®½åº¦ã€‚</li>
<li>scrollHeight å…ƒç´ çš„å±æ€§ï¼Œè¡¨ç¤ºå…ƒç´ å†…éƒ¨çš„æ»šåŠ¨å†…å®¹çš„é«˜åº¦ï¼Œä¸€èˆ¬æ¥è¯´ä¼šå¤§äºç­‰äºå…ƒç´ é«˜åº¦ã€‚</li>
<li>scroll(x, y) ä½¿å¾—å…ƒç´ æ»šåŠ¨åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œæœ‰åˆ«åscrollToï¼Œæ”¯æŒä¼ å…¥é…ç½®å‹å‚æ•° {top, left}ã€‚</li>
<li>scrollBy(x, y) ä½¿å¾—å…ƒç´ æ»šåŠ¨åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œæ”¯æŒä¼ å…¥é…ç½®å‹å‚æ•° {top, left}ã€‚</li>
<li>scrollIntoView(arg) æ»šåŠ¨å…ƒç´ æ‰€åœ¨çš„çˆ¶å…ƒç´ ï¼Œä½¿å¾—å…ƒç´ æ»šåŠ¨åˆ°å¯è§åŒºåŸŸï¼Œå¯ä»¥é€šè¿‡argæ¥æŒ‡å®šæ»šåˆ°ä¸­é—´ã€å¼€å§‹æˆ–è€…å°±è¿‘ã€‚</li>
</ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯æ»šåŠ¨çš„å…ƒç´ ä¹Ÿæ”¯æŒscrolläº‹ä»¶ï¼Œæˆ‘ä»¬åœ¨å…ƒç´ ä¸Šç›‘å¬å®ƒçš„äº‹ä»¶å³å¯ï¼š</p><pre><code>element.addEventListener(&quot;scroll&quot;, function(event){
  //......
})
</code></pre><p>è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå…ƒç´ éƒ¨åˆ†çš„APIè®¾è®¡ä¸è§†å£æ»šåŠ¨å‘½åé£æ ¼ä¸Šç•¥æœ‰å·®å¼‚ï¼Œä½ åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸è¦è®°æ··ã€‚</p><h2>å¸ƒå±€API</h2><p>æœ€åæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å¸ƒå±€APIï¼Œè¿™æ˜¯æ•´ä¸ªCSSOMä¸­æœ€å¸¸ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬åŒæ ·è¦åˆ†æˆå…¨å±€APIå’Œå…ƒç´ ä¸Šçš„APIã€‚</p><h3>å…¨å±€å°ºå¯¸ä¿¡æ¯</h3><p>windowå¯¹è±¡ä¸Šæä¾›äº†ä¸€äº›å…¨å±€çš„å°ºå¯¸ä¿¡æ¯ï¼Œå®ƒæ˜¯é€šè¿‡å±æ€§æ¥æä¾›çš„ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹æ¥è¿™äº›å±æ€§ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b6/10/b6c7281d86eb7214edf17069f95ae610.png?wh=1134*424" alt=""></p><ul>
<li>
<p>window.innerHeight, window.innerWidth è¿™ä¸¤ä¸ªå±æ€§è¡¨ç¤ºè§†å£çš„å¤§å°ã€‚</p>
</li>
<li>
<p>window.outerWidth, window.outerHeight è¿™ä¸¤ä¸ªå±æ€§è¡¨ç¤ºæµè§ˆå™¨çª—å£å æ®çš„å¤§å°ï¼Œå¾ˆå¤šæµè§ˆå™¨æ²¡æœ‰å®ç°ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸¤ä¸ªå±æ€§æ— å…³ç´§è¦ã€‚</p>
</li>
<li>
<p>window.devicePixelRatio è¿™ä¸ªå±æ€§éå¸¸é‡è¦ï¼Œè¡¨ç¤ºç‰©ç†åƒç´ å’ŒCSSåƒç´ å•ä½çš„å€ç‡å…³ç³»ï¼ŒRetinaå±è¿™ä¸ªå€¼æ˜¯2ï¼Œåæ¥ä¹Ÿå‡ºç°äº†ä¸€äº›3å€çš„Androidå±ã€‚</p>
</li>
<li>
<p>window.screen ï¼ˆå±å¹•å°ºå¯¸ç›¸å…³çš„ä¿¡æ¯ï¼‰</p>
<ul>
<li>window.screen.width, window.screen.height è®¾å¤‡çš„å±å¹•å°ºå¯¸ã€‚</li>
<li>window.screen.availWidth, window.screen.availHeight è®¾å¤‡å±å¹•çš„å¯æ¸²æŸ“åŒºåŸŸå°ºå¯¸ï¼Œä¸€äº›Androidæœºå™¨ä¼šæŠŠå±å¹•çš„ä¸€éƒ¨åˆ†é¢„ç•™åšå›ºå®šæŒ‰é’®ï¼Œæ‰€ä»¥æœ‰è¿™ä¸¤ä¸ªå±æ€§ï¼Œå®é™…ä¸Šä¸€èˆ¬æµè§ˆå™¨ä¸ä¼šå®ç°çš„è¿™ä¹ˆç»†è‡´ã€‚</li>
<li>window.screen.colorDepth, window.screen.pixelDepth è¿™ä¸¤ä¸ªå±æ€§æ˜¯å›ºå®šå€¼24ï¼Œåº”è¯¥æ˜¯ä¸ºäº†ä»¥åé¢„ç•™ã€‚</li>
</ul>
</li>
</ul><p>è™½ç„¶windowæœ‰è¿™ä¹ˆå¤šç›¸å…³ä¿¡æ¯ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ˜¯innerHeightã€innerWidthå’ŒdevicePixelRatioä¸‰ä¸ªå±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å‰ç«¯å¼€å‘å·¥ä½œåªéœ€è¦è·Ÿè§†å£æ‰“äº¤é“ï¼Œå…¶å®ƒä¿¡æ¯å¤§æ¦‚äº†è§£å³å¯ã€‚</p><h3>å…ƒç´ çš„å¸ƒå±€ä¿¡æ¯</h3><p>æœ€åæˆ‘ä»¬æ¥åˆ°äº†æœ¬èŠ‚è¯¾ä¸€å¼€å§‹æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½å¤Ÿå–åˆ°ä¸€ä¸ªå…ƒç´ çš„å®½ï¼ˆwidthï¼‰å’Œé«˜ï¼ˆheightï¼‰å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥ä»è„‘ä¸­æ¶ˆé™¤â€œå…ƒç´ æœ‰å®½é«˜â€è¿™æ ·çš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¯¾ç¨‹ä¸­å·²ç»å¤šæ¬¡æåˆ°äº†ï¼Œæœ‰äº›å…ƒç´ å¯èƒ½äº§ç”Ÿå¤šä¸ªç›’ï¼Œäº‹å®ä¸Šï¼Œåªæœ‰ç›’æœ‰å®½å’Œé«˜ï¼Œå…ƒç´ æ˜¯æ²¡æœ‰çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è·å–å®½é«˜çš„å¯¹è±¡åº”è¯¥æ˜¯â€œç›’â€ï¼Œäºæ˜¯CSSOM Viewä¸ºElementç±»æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul>
<li>getClientRects();</li>
<li>getBoundingClientRect()ã€‚</li>
</ul><p>getClientRects ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«å…ƒç´ å¯¹åº”çš„æ¯ä¸€ä¸ªç›’æ‰€å æ®çš„å®¢æˆ·ç«¯çŸ©å½¢åŒºåŸŸï¼Œè¿™é‡Œæ¯ä¸€ä¸ªçŸ©å½¢åŒºåŸŸå¯ä»¥ç”¨ x, y, width, height æ¥è·å–å®ƒçš„ä½ç½®å’Œå°ºå¯¸ã€‚</p><p>getBoundingClientRect ï¼Œè¿™ä¸ªAPIçš„è®¾è®¡æ›´æ¥è¿‘æˆ‘ä»¬è„‘æµ·ä¸­çš„å…ƒç´ ç›’çš„æ¦‚å¿µï¼Œå®ƒè¿”å›å…ƒç´ å¯¹åº”çš„æ‰€æœ‰ç›’çš„åŒ…è£¹çš„çŸ©å½¢åŒºåŸŸï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªAPIè·å–çš„åŒºåŸŸä¼šåŒ…æ‹¬å½“overflowä¸ºvisibleæ—¶çš„å­å…ƒç´ åŒºåŸŸã€‚</p><p>æ ¹æ®å®é™…çš„ç²¾ç¡®åº¦éœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½•æ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªAPIã€‚</p><p>è¿™ä¸¤ä¸ªAPIè·å–çš„çŸ©å½¢åŒºåŸŸéƒ½æ˜¯ç›¸å¯¹äºè§†å£çš„åæ ‡ï¼Œè¿™æ„å‘³ç€ï¼Œè¿™äº›åŒºåŸŸéƒ½æ˜¯å—æ»šåŠ¨å½±å“çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¦è·å–ç›¸å¯¹åæ ‡ï¼Œæˆ–è€…åŒ…å«æ»šåŠ¨åŒºåŸŸçš„åæ ‡ï¼Œéœ€è¦ä¸€ç‚¹å°æŠ€å·§ï¼š</p><pre><code class="language-JavaScript">var offsetX = document.documentElement.getBoundingClientRect().x - element.getBoundingClientRect().x;
</code></pre><p>å¦‚è¿™æ®µä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦è·å–æ–‡æ¡£è·ŸèŠ‚ç‚¹çš„ä½ç½®ï¼Œå†ç›¸å‡å³å¯å¾—åˆ°å®ƒä»¬çš„åæ ‡ã€‚</p><p>è¿™ä¸¤ä¸ªAPIçš„å…¼å®¹æ€§éå¸¸å¥½ï¼Œå®šä¹‰åˆéå¸¸æ¸…æ™°ï¼Œå»ºè®®ä½ å¦‚æœæ˜¯ç”¨JavaScriptå®ç°è§†è§‰æ•ˆæœæ—¶ï¼Œå°½é‡ä½¿ç”¨è¿™ä¸¤ä¸ªAPIã€‚</p><h2>ç»“è¯­</h2><p>ä»Šå¤©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†CSSOMè¿™ä¸€ç±»å‹çš„APIã€‚æˆ‘ä»¬é¦–å…ˆå°±è¯´åˆ°äº†ï¼Œå°±åƒHTMLå’ŒCSSåˆ†åˆ«æ‰¿æ‹…äº†è¯­ä¹‰å’Œè¡¨ç°çš„åˆ†å·¥ï¼ŒDOMå’ŒCSSOMä¹Ÿæœ‰è¯­ä¹‰å’Œè¡¨ç°çš„åˆ†å·¥ã€‚</p><p>CSSOMæ˜¯CSSçš„å¯¹è±¡æ¨¡å‹ï¼Œåœ¨W3Cæ ‡å‡†ä¸­ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šæè¿°æ ·å¼è¡¨å’Œè§„åˆ™ç­‰CSSçš„æ¨¡å‹éƒ¨åˆ†ï¼ˆCSSOMï¼‰ï¼Œå’Œè·Ÿå…ƒç´ è§†å›¾ç›¸å…³çš„Viewéƒ¨åˆ†ï¼ˆCSSOM Viewï¼‰ã€‚</p><p>æœ€åç•™ç»™ä½ ä¸€ä¸ªé—®é¢˜ï¼Œå†™å¥½æ¬¢è¿ç•™è¨€æ¥è®¨è®ºï¼Œè¯·æ‰¾ä¸€ä¸ªç½‘é¡µï¼Œç”¨æˆ‘ä»¬ä»Šå¤©è®²çš„APIï¼ŒæŠŠé¡µé¢ä¸Šçš„æ‰€æœ‰ç›’çš„è½®å»“ç”»åˆ°ä¸€ä¸ªcanvaså…ƒç´ ä¸Šã€‚</p><h1>çŒœä½ å–œæ¬¢</h1><p><a href="https://time.geekbang.org/course/intro/163?utm_term=zeusMTA7L&amp;utm_source=app&amp;utm_medium=chongxueqianduan&amp;utm_campaign=163-presell"><img src="https://static001.geekbang.org/resource/image/1a/08/1a49758821bdbdf6f0a8a1dc5bf39f08.jpg?wh=1032*330" alt="unpreview"></a></p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/35/d0/f2ac6d91.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é˜¿æˆ</span>
  </div>
  <div class="_2_QraFYR_0">Look via gist: https:&#47;&#47;gist.github.com&#47;aimergenge&#47;2bcf41ac4c4d2586e48ccd5cec5c9768<br><br>void function () {<br>  const canvas = document.createElement(&#39;canvas&#39;)<br><br>  canvas.width = document.documentElement.offsetWidth<br>  canvas.height = document.documentElement.offsetHeight<br><br>  canvas.style.position = &#39;absolute&#39;<br>  canvas.style.left = &#39;0&#39;<br>  canvas.style.right = &#39;0&#39;<br>  canvas.style.top = &#39;0&#39;<br>  canvas.style.bottom = &#39;0&#39;<br>  canvas.style.zIndex = &#39;99999&#39;<br><br>  document.body.appendChild(canvas)<br><br>  const ctx = canvas.getContext(&#39;2d&#39;)<br>  draw(ctx, getAllRects())<br><br>  function draw (ctx, rects) {<br>    let i = 0<br>    ctx.strokeStyle = &#39;red&#39;<br>    window.requestAnimationFrame(_draw)<br><br>    function _draw () {<br>      let {x, y, width, height} = rects[i++]<br>      ctx.strokeRect(x, y, width, height)<br>      if (i &lt; rects.length) {<br>        window.requestAnimationFrame(_draw)<br>      } else {<br>        console.log(&#39;%cDONE&#39;, &#39;background-color: green; color: white; padding: 0.3em 0.5em;&#39;)<br>      }<br>    }<br>  }<br><br>  function getAllRects () {<br>    const allElements = document.querySelectorAll(&#39;*&#39;)<br>    const rects = []<br>    const {x: htmlX, y: htmlY} = document.documentElement.getBoundingClientRect()<br>    allElements.forEach(element =&gt; {<br>      const eachElRects = Array.from(element.getClientRects()).filter(rect =&gt; {<br>        return rect.width || rect.height<br>      }).map(rect =&gt; {<br>        return {<br>          x: rect.x - htmlX,<br>          y: rect.y - htmlY,<br>          width: rect.width,<br>          height: rect.height<br>        }<br>      })<br>      rects.push(...eachElRects)<br>    })<br>    return rects<br>  }<br>}()<br></div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-16 13:47:52</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/fb/29/aaa16933.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>welkin</span>
  </div>
  <div class="_2_QraFYR_0">å¸Œæœ›ä½œè€…èƒ½è®²ä¸€ä¸‹è™šæ‹Ÿdom<br>è¿˜æœ‰æµè§ˆå™¨çš„é‡ç»˜å’Œé‡æ’<br>ä»¥åŠæ€§èƒ½ä¼˜åŒ–ï¼Œè·¨åŸŸçš„å¸¸ç”¨æ“ä½œ(å¸Œæœ›ç»†è‡´ä¸€ç‚¹)<br>åŒ…æ‹¬ä¸€äº›æ¼æ´å’Œæ”»å‡»ï¼Œæ¯”å¦‚xssï¼Œsqlæ³¨å…¥<br>è¿˜æœ‰ä¸€äº›æŠ€æœ¯æ ˆï¼Œå’Œä¸€äº›å¯¹äºå‰ç«¯éœ€è¦äº†è§£çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ç¦»çº¿æ–¹æ¡ˆç­‰</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-25 00:11:03</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/7b/85/385fe515.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>çƒ­å¿ƒç½‘å‹å¥½å®…ğŸ’«</span>
  </div>
  <div class="_2_QraFYR_0">ä¸€ç›´å¿ç€æ²¡é—®ï¼Œå“ªæ¥è¿™ä¹ˆå¤šçŒ«ç‰‡ğŸ¤£</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-25 08:26:40</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/d6/dc/c454588f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç—•è¿‘ç—•è¿œ</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®è€å¸ˆï¼Œå¦‚ä½•è§£å†³UIè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå®šä½æ ‡ç­¾æ˜¾ç¤ºå…ƒç´ ä¸å¯è§çš„é—®é¢˜</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-17 06:53:52</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ericK6f30odtlIjX0Sw5cA3v259nLp2ibba5nQdzRk8cckZlruN6XtvEmRYKblibosiaiauVxh1NDxicESg/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å®‹å®‹</span>
  </div>
  <div class="_2_QraFYR_0">å‰é¢è®²æµè§ˆå™¨æ¸²æŸ“æ—¶æœ‰è®²åˆ°ï¼ŒCSSç»è¿‡è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æè¢«è§£ææˆä¸€é¢—æŠ½è±¡è¯­æ³•æ ‘ã€‚<br>è¿™ä¸ªæŠ½è±¡è¯­æ³•æ ‘å’ŒCSSOMæœ‰ä»€ä¹ˆå…³è”ä¹ˆï¼Ÿå› ä¸ºå¾ˆå¤šæ–‡ç« éƒ½è®²CSSç»è¿‡è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æè¢«è§£ææˆCSSOMï¼Œæ„Ÿè§‰å¾ˆç–‘æƒ‘ã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-16 22:52:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/60/de/5c67895a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å‘¨é£</span>
  </div>
  <div class="_2_QraFYR_0">&lt;body&gt;<br> &lt;canvas id=&quot;rect&quot;&gt;&lt;&#47;canvas&gt; <br>&lt;script type=&quot;text&#47;javascript&quot;&gt;    <br>             const canvas = document.getElementById(&#39;rect&#39;);<br>             canvas.width =document.documentElement.getBoundingClientRect().width;<br>             canvas.height = document.documentElement.getBoundingClientRect().height;<br>             canvas.style.position=&quot;absolute&quot;;<br>             canvas.style.top=0;<br>             canvas.style.left=0;<br>             canvas.style.border=&#39;1px solid red&#39;;<br>             const ctx = canvas.getContext(&#39;2d&#39;);<br>             function travaldom(root){                    <br>               if(root.tagName &amp;&amp; root.tagName !==&#39;text&#39; &amp;&amp; root.tagName!==&#39;canvas&#39;){<br>                  const startX = root.getBoundingClientRect().x;<br>                  const startY = root.getBoundingClientRect().y;<br>                  const width = root.getBoundingClientRect().width;<br>                  const height = root.getBoundingClientRect().height;<br>                  ctx.beginPath();<br>                  ctx.lineWidth=&quot;1&quot;;<br>                  ctx.strokeStyle=&quot;blue&quot;;<br>                  ctx.rect(startX,startY,width,height);<br>                  ctx.stroke();<br>               }<br>               root.childNodes.forEach(node=&gt;{<br>                   travaldom(node);<br>               });<br>             }<br>             travaldom(document);<br>        &lt;&#47;script&gt;	<br>&lt;&#47;body&gt;</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-07 15:27:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/f7/2f/10cbed82.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>pcxpccccx_</span>
  </div>
  <div class="_2_QraFYR_0">å†²å†²å†²</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-22 21:13:37</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/cc/b1/97549d7d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ã€‚ã€‚ã€‚</span>
  </div>
  <div class="_2_QraFYR_0">display:inline;çš„å…ƒç´ ä¼šä¸ä¼šäº§ç”Ÿç›’ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¼šï¼Œè€Œä¸”ä¼šäº§ç”Ÿå¤šä¸ªç›’</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-09 13:07:38</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/02/a3/b7e7a787.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Russell</span>
  </div>
  <div class="_2_QraFYR_0">emm~~ æˆ‘åˆè¯»äº†ä¸€éæ–‡æ¡£ï¼Œå‘ç°äº†å¯¹æˆ‘æ¥è¯´å¾ˆå…³é”®è¯ï¼Œâ€œç‹­ä¹‰çš„â€ã€‚ é‚£æˆ‘ç°åœ¨çš„ç†è§£æ˜¯é…±ç´«çš„ã€‚  å¹¿ä¹‰çš„ç†è§£ï¼Œå°±æ˜¯BOM+DOMï¼ŒCSSOMæ˜¯DOMæ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼›å¦‚æœç‹­ä¹‰çš„è®¤ä¸ºDOMå°±æ˜¯æ ‘å½¢ç»“æ„çš„è¯ï¼Œå°±å¯ä»¥åˆ†å‡ºæ¥DOMã€CSSOMä¸¤éƒ¨åˆ†å†…å®¹äº†ã€‚ æˆ‘è¿™æ ·æƒ³å¯¹ä¹ˆï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-03 15:14:26</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Fiona B Y Fan</span>
  </div>
  <div class="_2_QraFYR_0">é€šè¿‡document.getStyleSheetsä¿®æ”¹styleä»¥åŠwindow.getComputedStyle window.getBoundingClientRect window.getClientRectsæ–¹æ³•ä¼šå¯¼è‡´é‡æ’å’Œé‡ç»˜ï¼Œå½±å“æ€§èƒ½ï¼Œä¸æ˜¯åº”è¯¥å°‘ç”¨å—</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-04-17 16:21:09</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/27/98/fb/aa63be6f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>pasico</span>
  </div>
  <div class="_2_QraFYR_0"><br><br>function dfs(top, callback){<br>    let node = top<br>    let stack = Array.from(node.children).reverse()<br>    callback(node)<br>    while(stack.length){<br>        node = stack.pop()<br>        callback(node)<br>        stack.push(...Array.from(node.children).reverse())<br>    }<br>}<br><br>function traverse(){<br>    let body = document.body<br>    &#47;&#47; let color = 0<br>    let time = 0<br>    let count = 0<br>    let can = document.createElement(&#39;canvas&#39;)<br>    can.style.position = &#39;fixed&#39;<br>    can.style.top=0<br>    can.style.left=0<br>    let ctx = can.getContext(&#39;2d&#39;)<br>    const callback=(node)=&gt;{<br>        time+=50<br>        count++<br>        setTimeout(()=&gt;{            <br>            var {x,y,width,height} = node.getBoundingClientRect()<br>            console.log(&#39;count&#39;, count, node, x, y, width, height)<br>            if(node === body){<br>                can.style.width = width<br>                can.width = width<br>                can.style.height = height<br>                can.height = height<br>            }<br>            &#47;&#47; color++<br>            &#47;&#47; ctx.fillStyle=`rgb(${color%255},${color%255},${color%255})`;<br>            &#47;&#47; ctx.fillRect(x,y,width, height)<br>            ctx.strokeStyle = &#39;green&#39;;<br>            ctx.strokeRect(x, y, width, height);<br>        }, time)<br>    }<br>    dfs(body, callback)<br>    body.appendChild(can)<br>}<br><br>traverse()</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-02-17 17:06:36</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/51/9f/1840385e.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>èƒ¡æ°¸</span>
  </div>
  <div class="_2_QraFYR_0"><br>    const newWindow = window.open(&quot;about:blank&quot;, &quot;_blank&quot;, &quot;width=100,height=100,left=100,right=100&quot;)<br>    const canvas = newWindow.document.body.appendChild(newWindow.document.createElement(&#39;canvas&#39;));<br>    canvas.width = document.documentElement.offsetWidth<br>    canvas.height = document.documentElement.offsetHeight<br><br>    canvas.style.position = &#39;absolute&#39;<br>    canvas.style.left = &#39;0&#39;<br>    canvas.style.right = &#39;0&#39;<br>    canvas.style.top = &#39;0&#39;<br>    canvas.style.bottom = &#39;0&#39;<br>    canvas.style.zIndex = &#39;99999&#39;<br><br>    const ctx = canvas.getContext(&#39;2d&#39;);<br>    const { x: htmlX, y: htmlY } = document.documentElement.getBoundingClientRect()<br><br>    let tagsArr = new Set();<br>    void function getAllElementsTag() {<br>        const body = document.body;<br>        const { width, height } = document.documentElement.getBoundingClientRect();<br>        return recurtion(body);<br>    }()<br><br><br>    function drawCanvas(ele) {<br>        const offsetX = ele.getBoundingClientRect().x - htmlX;<br>        const offsetY = ele.getBoundingClientRect().y - htmlY;<br>        const { width, height } = ele.getBoundingClientRect();<br>        ctx.strokeStyle = &#39;red&#39;;<br>        ctx.strokeRect(offsetX, offsetY, width, height);<br>    }<br><br><br>    function recurtion(ele) {<br>        tagsArr.add(ele.nodeName.slice(0).toLowerCase());<br>        drawCanvas(ele)<br>        if (!ele.hasChildNodes()) return;<br>        ele.childNodes.forEach(item =&gt; {<br>            if (item.hasChildNodes()) {<br>                return recurtion(item)<br>            }<br>            if (!&#47;#&#47;.test(item.nodeName)) {<br>                drawCanvas(item)<br>            }<br><br>            tagsArr.add(item.nodeName.slice(0).toLowerCase())<br>        })<br>    }</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-06-16 12:30:42</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/bc/e8/43109d54.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Peter</span>
  </div>
  <div class="_2_QraFYR_0"><br>&#47;&#47; åˆ›å»ºè¦†ç›–åœ¨ç½‘é¡µä¸Šæ–¹çš„canvas<br>const cvs = document.createElement(&#39;canvas&#39;)<br>cvs.width = document.documentElement.scrollWidth;<br>cvs.height = document.documentElement.scrollHeight;<br>cvs.style.position = &#39;absolute&#39;;<br>cvs.style.zIndex = 1000;<br>cvs.style.left = 0;<br>cvs.style.top = 0;<br>ctx = cvs.getContext(&#39;2d&#39;);<br>ctx.strokeStyle=&quot;red&quot;;<br><br>&#47;&#47; æŸ¥æ‰¾æ‰€æœ‰å—å…ƒç´ ï¼Œè®¡ç®—ä½ç½®å¹¶åœ¨å¯¹åº”åæ ‡ç»˜åˆ¶è¾¹æ¡†åœ¨canvasä¸Šã€‚<br>const BlockLevel = [&#39;block&#39;, &#39;inline-block&#39;, &#39;inline-table&#39;, &#39;table&#39;, &#39;flex&#39;, &#39;grid&#39;, &#39;flow-root&#39;];<br>[].forEach.call(document.body.getElementsByTagName(&#39;*&#39;), (item) =&gt; {<br>    if (BlockLevel.indexOf(getComputedStyle(item).display) &gt; -1) {<br>        const rect = item.getBoundingClientRect();<br>        const { x, y, width, height } = rect;<br>        ctx.strokeRect(x, y, width, height);<br>    }<br>})<br><br>document.body.append(cvs);<br></div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-06-30 15:58:39</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/26/22/dd505e6d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Yully</span>
  </div>
  <div class="_2_QraFYR_0">removeRuleè¢«deleteRuleå–ä»£äº†ï¼Œå»ºè®®ç”¨deleteRuleï¼Œç”¨æ³•éƒ½ä¸€æ ·</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-06-05 18:19:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/17/ee/18/802b61e5.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è¥¿ä¼¯åˆ©äºšé›ªæ©‡çŠ¬</span>
  </div>
  <div class="_2_QraFYR_0">IEçš„edgeç‰ˆæœ¬scrolläº‹ä»¶ï¼Œäº‹ä»¶ä¸­ä¸€ä¸ªå…ƒç´ è¿›è¡Œå®šä½ï¼Œæœ‰æ®‹å½±ï¼Œè°·æ­Œå°±æ˜¯å¹³æ»‘ç§»åŠ¨</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-02-17 06:46:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/02/a3/b7e7a787.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Russell</span>
  </div>
  <div class="_2_QraFYR_0">ä¸å¯¹ï¼Œæˆ‘è§‰å¾—æˆ‘è¿™ä¹ˆç†è§£ä¸å¯¹ã€‚ã€‚ã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-03 14:18:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/02/a3/b7e7a787.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Russell</span>
  </div>
  <div class="_2_QraFYR_0">è¿™ä¸ªå’‹æ¢è¡Œå•Šã€‚ã€‚ã€‚ ä¸å¥½æ„æ€ï¼Œè€å¸ˆå¥½ï¼Œæˆ‘æƒ³å’¨è¯¢æµè§ˆå™¨APIçš„ç§ç±»ã€‚ æˆ‘å¯ä»¥è®¤ä¸ºæ˜¯ï¼ŒDOMï¼ŒBOMï¼ŒCSSOMè¿™å‡ ç±»ä¹ˆï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™æ˜¯å‡ ä¸ªå¤§ç±»ï¼Œè¿˜æœ‰å¥½å¤šæ¸¸ç¦»çš„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-03 14:08:00</div>
  </div>
</div>
</div>
</li>
</ul>